!function(e,t,r,s,i){var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof n[s]&&n[s],o=a.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function d(t,r){if(!o[t]){if(!e[t]){var i="function"==typeof n[s]&&n[s];if(!r&&i)return i(t,!0);if(a)return a(t,!0);if(l&&"string"==typeof t)return l(t);var h=Error("Cannot find module '"+t+"'");throw h.code="MODULE_NOT_FOUND",h}c.resolve=function(r){var s=e[t][1][r];return null!=s?s:r},c.cache={};var u=o[t]=new d.Module(t);e[t][0].call(u.exports,c,u,u.exports,this)}return o[t].exports;function c(e){var t=c.resolve(e);return!1===t?{}:d(t)}}d.isParcelRequire=!0,d.Module=function(e){this.id=e,this.bundle=d,this.exports={}},d.modules=e,d.cache=o,d.parent=a,d.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(d,"root",{get:function(){return n[s]}}),n[s]=d;for(var h=0;h<t.length;h++)d(t[h]);if(r){var u=d(r);"object"==typeof exports&&"undefined"!=typeof module?module.exports=u:"function"==typeof define&&define.amd&&define(function(){return u})}}({diwG0:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js"),i=e("~CardLib/Debug"),n=e("~Games/Klondike/GameInfo"),a=s.interopDefault(n),o=e("~Games/KlondikeEx/GameInfo"),l=s.interopDefault(o),d=e("~Games/Pyramid/GameInfo"),h=s.interopDefault(d);let u=new Map;u.set(a.default.gameId,a.default),u.set(l.default.gameId,l.default),u.set(h.default.gameId,h.default),window.addEventListener("load",()=>{let e;let t=document.getElementById("tableHolder")??document.body,r=()=>{let r,s;e&&(e.dispose(),e=void 0);let n=window.location.hash,o=n.indexOf("?");o>=0?(r=new URLSearchParams(n.substr(o+1)),s=n.substr(1,o-1)):n.includes("&")||n.includes("?")||n.includes("=")?s=(r=new URLSearchParams(n.substr(1))).get("game"):(r=new URLSearchParams(""),s=n.substr(1)),s||(s=a.default.gameId);let l=u.get(s.toLowerCase());l||i.error(`Unknown game ${s}.`),(e=l.gamePresenterFactory.createGame(t,r)).start()};window.addEventListener("hashchange",r),r()})},{"~CardLib/Debug":"7pQt2","~Games/Klondike/GameInfo":"aPH0w","~Games/KlondikeEx/GameInfo":"2W9ph","~Games/Pyramid/GameInfo":"7J9V3","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"7pQt2":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e,t){e||n(t)}function n(e){throw Error(e=e??"Assert failed")}s.defineInteropFlag(r),s.export(r,"assert",()=>i),s.export(r,"error",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],lOn3Z:[function(e,t,r){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||Object.prototype.hasOwnProperty.call(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}],aPH0w:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);var s=e("./Presenter/GamePresenterFactory");class i{gameId="klondike";gameName="Klondike";gamePresenterFactory=new s.GamePresenterFactory}r.default=new i},{"./Presenter/GamePresenterFactory":"99c6t","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"99c6t":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GAME_ID",()=>l),s.export(r,"GamePresenterFactory",()=>d);var i=e("~CardLib/View/RootView"),n=e("../Model/Game"),a=e("../Model/GameOptions"),o=e("./GamePresenter");let l="klondike";class d{createGame(e,t){let r=new a.GameOptions(t),s=new n.Game(r),l=new i.RootView(e);return new o.GamePresenter(s,l)}}},{"~CardLib/View/RootView":"feB3F","../Model/Game":"lrUxc","../Model/GameOptions":"3ngPc","./GamePresenter":"680f9","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],feB3F:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"RootView",()=>a);var i=e("./ViewContext"),n=e("./ViewUtils");class a{context;element;constructor(e){this.context=new i.ViewContext(e),this.element=(0,n.instantiateTemplate)(e,"rootViewTemplate")}dispose(){this.element.remove()}}},{"./ViewContext":"lj9AI","./ViewUtils":"9XVxt","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],lj9AI:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"ViewContext",()=>n);var i=e("~CardLib/Debug");class n{static TOUCH_DEADZONE=5;static TOUCH_DEADZONE_SQ=25;element_;touchResponders_=[];pxPerRem_=0;get pxPerRem(){return this.pxPerRem_}constructor(e){this.element_=e,window.addEventListener("resize",this.onResize_),window.addEventListener("mousemove",this.onWindowMouseMove_),window.addEventListener("mouseup",this.onWindowMouseUp_),window.addEventListener("touchmove",this.onWindowTouchMove_),window.addEventListener("touchend",this.onWindowTouchEnd_),window.addEventListener("touchcancel",this.onWindowTouchCancel_),this.refreshUnits_()}onResize_=()=>{this.refreshUnits_()};refreshUnits_(){let e=getComputedStyle(this.element_);this.pxPerRem_=1/parseFloat(e.fontSize)}addTouchResponder(e){let t=this.touchResponders_.indexOf(e);i.assert(t<0),this.touchResponders_.push(e)}removeTouchResponder(e){let t=this.touchResponders_.indexOf(e);i.assert(t>=0),this.touchResponders_.splice(t,1)}onWindowMouseMove_=e=>{if(1!==e.buttons)for(let t of this.touchResponders_)t.onTouchUp(-1,!0,e.timeStamp);else for(let t of this.touchResponders_)t.onTouchMoved(-1,e.pageX,e.pageY,e.timeStamp)};onWindowMouseUp_=e=>{if(0===e.button)for(let t of this.touchResponders_)t.onTouchUp(-1,!1,e.timeStamp)};onWindowTouchMove_=e=>{for(let t=0;t<e.changedTouches.length;++t){let r=e.changedTouches.item(t);if(r)for(let t of this.touchResponders_)t.onTouchMoved(r.identifier,r.pageX,r.pageY,e.timeStamp)}};onWindowTouchEnd_=e=>{for(let t=0;t<e.changedTouches.length;++t){let r=e.changedTouches.item(t);if(r)for(let t of this.touchResponders_)t.onTouchUp(r.identifier,!1,e.timeStamp)}};onWindowTouchCancel_=e=>{for(let t=0;t<e.changedTouches.length;++t){let r=e.changedTouches.item(t);if(r)for(let t of this.touchResponders_)t.onTouchUp(r.identifier,!0,e.timeStamp)}}}},{"~CardLib/Debug":"7pQt2","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"9XVxt":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"instantiateTemplate",()=>n);var i=e("~CardLib/Debug");function n(e,t){let r=document.getElementById(t);r instanceof HTMLTemplateElement||i.error();let s=r.content.firstElementChild;s instanceof HTMLElement||i.error();let n=document.importNode(s,!0);return n instanceof HTMLElement||i.error(),e.appendChild(n)}},{"~CardLib/Debug":"7pQt2","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],lrUxc:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"Game",()=>h);var i=e("~CardLib/Debug"),n=e("~CardLib/Model/DeckUtils"),a=e("~CardLib/Model/DelayHint"),o=e("~CardLib/Model/GameBase"),l=e("~CardLib/Model/Pile"),d=e("~CardLib/Model/Rank");class h extends o.GameBase{options;stock=new l.Pile(this);waste=new l.Pile(this);foundations=[];tableaux=[];dragSingleSources_=[];autoMoveSources_=[];restocks_=0;constructor(e){super(),this.options=e,this.piles.push(this.stock),this.piles.push(this.waste),this.dragSingleSources_.push(this.waste),this.autoMoveSources_.push(this.waste);for(let e=0;e<4;++e){let e=new l.Pile(this);this.foundations.push(e),this.dragSingleSources_.push(e),this.piles.push(e)}for(let e=0;e<7;++e){let e=new l.Pile(this);this.tableaux.push(e),this.dragSingleSources_.push(e),this.autoMoveSources_.push(e),this.piles.push(e)}this.cards=n.createStandard52Deck(this.stock)}doGetWon_(){let e=0;for(let t of this.foundations)e+=t.length;return 52===e}get wonCards(){let e=[];for(let t of this.foundations)for(let r of t)e.push(r);return e.sort((e,t)=>e.pileIndex>t.pileIndex?1:e.pileIndex<t.pileIndex?-1:e.rank>t.rank?1:e.rank<t.rank?-1:0),e}*restart_(e){for(let e of(this.restocks_=0,this.stock))e.faceUp=!1;for(let e=this.piles.length;e-- >0;){let t=this.piles[e]??i.error();if(t!==this.stock)for(let e=t.length;e-- >0;){let r=t.at(e);r.faceUp=!1,this.stock.push(r)}}this.stock.sort(),this.stock.shuffle(e),yield a.DelayHint.Settle;for(let e=0;e<this.tableaux.length;++e){let t=this.tableaux[e]??i.error();for(let r=0;r<=e;++r){let e=this.stock.peek();e&&(t.push(e),yield a.DelayHint.Quick)}}yield a.DelayHint.OneByOne,yield*this.doAutoMoves_()}*cardPrimary_(e){if(this.stock.peek()===e&&this.canDrawFromStock_()){yield*this.doDrawFromStock_(),yield*this.doAutoMoves_();return}if(this.tableaux.indexOf(e.pile)&&e.pile.peek()===e&&!e.faceUp){e.faceUp=!0,yield a.DelayHint.OneByOne,yield*this.doAutoMoves_();return}}*cardSecondary_(e){if(this.autoMoveSources_.indexOf(e.pile)>=0){for(let t of this.foundations)if(this.isFoundationDrop_(e,t)){t.push(e),yield a.DelayHint.OneByOne,yield*this.doAutoMoves_();return}}}*pilePrimary_(e){if(e===this.stock&&0===this.stock.length&&this.waste.length>0&&this.restocks_<this.options.restocksAllowed){this.restocks_++;for(let e=this.waste.length;e-- >0;)this.waste.at(e).faceUp=!1;this.waste.maxFan=0,yield a.DelayHint.OneByOne;for(let e=this.waste.length;e-- >0;){let t=this.waste.at(e);this.stock.push(t)}yield a.DelayHint.OneByOne,yield*this.doAutoMoves_();return}}*pileSecondary_(e){}canDrag_(e){return this.isFoundationDropSource_(e)?{canDrag:!0,extraCards:[]}:this.isTableauxDropSource_(e)?{canDrag:!0,extraCards:e.pile.slice(e.pileIndex+1)}:{canDrag:!1,extraCards:[]}}previewDrop_(e,t){return this.isTableauxDrop_(e,t)||this.isFoundationDrop_(e,t)}*dropCard_(e,t){this.isTableauxDrop_(e,t)?(yield*this.doTableauxDrop_(e,t),yield*this.doAutoMoves_()):this.isFoundationDrop_(e,t)&&(yield*this.doFoundationDrop_(e,t),yield*this.doAutoMoves_())}canDrawFromStock_(){return this.stock.length>0}*doDrawFromStock_(){this.waste.maxFan=0;for(let e=0;e<this.options.stockDraws;++e){let t=this.stock.peek();t&&(this.waste.push(t),this.waste.maxFan++,yield a.DelayHint.Quick,t.faceUp=!0,e<this.options.stockDraws-1&&(yield a.DelayHint.Quick))}yield a.DelayHint.OneByOne}isTableauxDrop_(e,t){if(e.pile===t||!this.isTableauxDropSource_(e))return!1;if(this.tableaux.indexOf(t)>=0){let r=t.peek();if(r){if(this.getCardValue_(r)===this.getCardValue_(e)+1&&r.colour!==e.colour)return!0}else if(e.rank===d.Rank.King)return!0}return!1}isTableauxDropSource_(e){if(this.dragSingleSources_.indexOf(e.pile)>=0&&e.pile.peek()===e&&e.faceUp)return!0;if(this.tableaux.indexOf(e.pile)>=0&&e.pile.peek()?.faceUp)for(let t=e.pile.length-1;t-- >0;){let r=e.pile.at(t),s=e.pile.at(t+1);if(r.faceUp&&s.faceUp&&r.colour!==s.colour&&this.getCardValue_(s)===this.getCardValue_(r)-1){if(r===e)return!0}else break}return!1}*doTableauxDrop_(e,t){let r=e.pile;for(let r of e.pile.slice(e.pileIndex))t.push(r);r===this.waste&&this.waste.maxFan--,yield a.DelayHint.OneByOne}isFoundationDrop_(e,t){if(e.pile===t||!this.isFoundationDropSource_(e))return!1;if(this.foundations.indexOf(t)>=0){let r=t.peek();if(r){if(this.getCardValue_(r)+1===this.getCardValue_(e)&&r.suit===e.suit)return!0}else if(e.rank===d.Rank.Ace)return!0}return!1}isFoundationDropSource_(e){return this.dragSingleSources_.indexOf(e.pile)>=0&&e.pile.peek()===e&&e.faceUp}*doFoundationDrop_(e,t){let r=e.pile;t.push(e),r===this.waste&&this.waste.maxFan--,yield a.DelayHint.OneByOne}getCardValue_(e){switch(e.rank){case d.Rank.Ace:return 1;case d.Rank.Two:return 2;case d.Rank.Three:return 3;case d.Rank.Four:return 4;case d.Rank.Five:return 5;case d.Rank.Six:return 6;case d.Rank.Seven:return 7;case d.Rank.Eight:return 8;case d.Rank.Nine:return 9;case d.Rank.Ten:return 10;case d.Rank.Jack:return 11;case d.Rank.Queen:return 12;case d.Rank.King:return 13;default:i.error()}}*doAutoMoves_(){e:for(;;){if(this.options.autoReveal)for(let e of this.tableaux){let t=e.peek();if(t&&!t.faceUp){t.faceUp=!0,yield a.DelayHint.OneByOne;continue e}}if(this.options.autoMoveToFoundation>0){let e=999;for(let t of this.foundations){let r=t.peek();e=r?Math.min(e,this.getCardValue_(r)):Math.min(e,0)}for(let t of this.autoMoveSources_){let r=t.peek();if(r&&this.getCardValue_(r)<=e+this.options.autoMoveToFoundation){for(let e of this.foundations)if(this.isFoundationDrop_(r,e)){yield*this.doFoundationDrop_(r,e);continue e}}}}if(this.options.autoPlayStock&&0===this.waste.length&&this.canDrawFromStock_()){yield*this.doDrawFromStock_();continue}break}}}},{"~CardLib/Debug":"7pQt2","~CardLib/Model/DeckUtils":"kDLU7","~CardLib/Model/DelayHint":"lTDNY","~CardLib/Model/GameBase":"bxQph","~CardLib/Model/Pile":"cKYbt","~CardLib/Model/Rank":"63AzX","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],kDLU7:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"createStandard52Deck",()=>d);var i=e("./Colour"),n=e("./Rank"),a=e("./Suit");let o=[[a.Suit.Spades,i.Colour.Black],[a.Suit.Hearts,i.Colour.Red],[a.Suit.Diamonds,i.Colour.Red],[a.Suit.Clubs,i.Colour.Black]],l=[n.Rank.Ace,n.Rank.Two,n.Rank.Three,n.Rank.Four,n.Rank.Five,n.Rank.Six,n.Rank.Seven,n.Rank.Eight,n.Rank.Nine,n.Rank.Ten,n.Rank.Jack,n.Rank.Queen,n.Rank.King];function d(e){let t=[];for(let[r,s]of o)for(let i of l){let n=e.createCard(r,s,i);t.push(n)}return t}},{"./Colour":"ltEMf","./Rank":"63AzX","./Suit":"eNl9s","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],ltEMf:[function(e,t,r){var s,i,n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"Colour",()=>i),(s=i||(i={}))[s.None=0]="None",s[s.Black=1]="Black",s[s.Red=2]="Red"},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"63AzX":[function(e,t,r){var s,i,n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"Rank",()=>i),(s=i||(i={}))[s.None=0]="None",s[s.Ace=1]="Ace",s[s.Two=2]="Two",s[s.Three=3]="Three",s[s.Four=4]="Four",s[s.Five=5]="Five",s[s.Six=6]="Six",s[s.Seven=7]="Seven",s[s.Eight=8]="Eight",s[s.Nine=9]="Nine",s[s.Ten=10]="Ten",s[s.Eleven=11]="Eleven",s[s.Twelve=12]="Twelve",s[s.Thirteen=13]="Thirteen",s[s.Jack=100]="Jack",s[s.Queen=101]="Queen",s[s.King=102]="King"},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],eNl9s:[function(e,t,r){var s,i,n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"Suit",()=>i),(s=i||(i={}))[s.None=0]="None",s[s.Spades=1]="Spades",s[s.Hearts=2]="Hearts",s[s.Diamonds=3]="Diamonds",s[s.Clubs=4]="Clubs"},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],lTDNY:[function(e,t,r){var s,i,n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"DelayHint",()=>i),(s=i||(i={}))[s.None=0]="None",s[s.Quick=1]="Quick",s[s.OneByOne=2]="OneByOne",s[s.Settle=3]="Settle"},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],bxQph:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GameBase",()=>f);var i=e("pure-rand"),n=s.interopDefault(i),a=e("../Debug"),o=e("./Card"),l=e("./GameSerializationContext"),d=e("./Pile"),h=e("./Undoable/CardFlipOperation"),u=e("./Undoable/CompoundUndoableOperation"),c=e("./Undoable/PileInsertOperation"),p=e("./Undoable/PileMaxFanOperation");class f{cards=[];piles=[];undoStack_=[];redoStack_=[];currentOperation_=void 0;gamesStarted_=0;gamesStartedChanged=()=>{};get gamesStarted(){return this.gamesStarted_}set gamesStarted(e){e!==this.gamesStarted_&&(this.gamesStarted_=e,this.gamesStartedChanged())}gamesWon_=0;gamesWonChanged=()=>{};get gamesWon(){return this.gamesWon_}set gamesWon(e){e!==this.gamesWon_&&(this.gamesWon_=e,this.gamesWonChanged())}get canUndo(){return this.undoStack_.length>0}*undo(){let e=this.undoStack_.pop();e&&(e.undo(),this.redoStack_.push(e))}get canRedo(){return this.redoStack_.length>0}*redo(){let e=this.redoStack_.pop();e&&(e.redo(),this.undoStack_.push(e))}won_=!1;wonChanged=()=>{};get won(){return this.won_}set won(e){e!==this.won_&&(this.won_=e,this.wonChanged())}checkWon_(){let e=this.won;this.won=this.doGetWon_(),!e&&this.won&&(this.undoStack_=[],this.redoStack_=[],++this.gamesWon)}*restart(e){if(this.startOperation_()){this.won=!1,++this.gamesStarted;let t=(0,n.default).mersenne(e);yield*this.restart_(t),this.commitOperation_(),this.undoStack_=[],this.redoStack_=[],this.checkWon_()}}*pilePrimary(e){this.startOperation_()&&(e instanceof d.Pile||a.error(),a.assert(this.piles.indexOf(e)>=0),yield*this.pilePrimary_(e),this.commitOperation_(),this.checkWon_())}*pileSecondary(e){this.startOperation_()&&(e instanceof d.Pile||a.error(),a.assert(this.piles.indexOf(e)>=0),yield*this.pileSecondary_(e),this.commitOperation_(),this.checkWon_())}*cardPrimary(e){this.startOperation_()&&(e instanceof o.Card||a.error(),a.assert(this.cards.indexOf(e)>=0),yield*this.cardPrimary_(e),this.commitOperation_(),this.checkWon_())}*cardSecondary(e){this.startOperation_()&&(e instanceof o.Card||a.error(),a.assert(this.cards.indexOf(e)>=0),yield*this.cardSecondary_(e),this.commitOperation_(),this.checkWon_())}canDrag(e){return e instanceof o.Card||a.error(),a.assert(this.cards.indexOf(e)>=0),this.canDrag_(e)}previewDrop(e,t){return e instanceof o.Card||a.error(),t instanceof d.Pile||a.error(),a.assert(this.cards.indexOf(e)>=0),a.assert(this.piles.indexOf(t)>=0),this.previewDrop_(e,t)}*dropCard(e,t){this.startOperation_()&&(e instanceof o.Card||a.error(),t instanceof d.Pile||a.error(),a.assert(this.cards.indexOf(e)>=0),a.assert(this.piles.indexOf(t)>=0),yield*this.dropCard_(e,t),this.commitOperation_(),this.checkWon_())}startOperation_(){return!this.currentOperation_&&(this.currentOperation_=new u.CompoundUndoableOperation,!0)}addUndoableOperation(e){this.currentOperation_&&this.currentOperation_.addOperation(e)}commitOperation_(){this.currentOperation_||a.error(),this.currentOperation_.length>0&&(this.undoStack_.push(this.currentOperation_),this.redoStack_=[]),this.currentOperation_=void 0}serialize(){let e=this.createSerializationContext_();for(let t of(e.write(3),e.write(this.gamesStarted),e.write(this.gamesWon),this.cards))t.serializeState(e);for(let t of this.piles)t.serializeState(e);return this.serializeUndoStack_(e,this.undoStack_),this.serializeUndoStack_(e,this.redoStack_),e.toJson()}serializeUndoStack_(e,t){for(let r of(e.write(t.length),t))e.writeUndoable(r)}deserialize(e){try{this.won=!1;let t=this.createSerializationContext_();if(t.fromJson(e),3!==t.read())throw Error("Unknown save data format.");for(let e of(this.gamesStarted=t.read(),this.gamesWon=t.read(),this.cards))e.deserializeState(t);for(let e of this.piles)e.deserializeState(t);return this.undoStack_=this.deserializeUndoStack_(t),this.redoStack_=this.deserializeUndoStack_(t),t.ensureAtEnd(),this.won=this.doGetWon_(),!0}catch(e){return console.error("Failed to deserialize game state.",e),!1}}deserializeUndoStack_(e){let t=[],r=e.read();for(let s=0;s<r;++s)t.push(e.readUndoable());return t}createSerializationContext_(){let e=new l.GameSerializationContext;for(let t of this.cards)e.addCard(t);for(let t of this.piles)e.addPile(t);return e.addUndoableDeserializer(u.CompoundUndoableOperation.deserializer),e.addUndoableDeserializer(h.CardFlipOperation.deserializer),e.addUndoableDeserializer(c.PileInsertOperation.deserializer),e.addUndoableDeserializer(p.PileMaxFanOperation.deserializer),e}}},{"pure-rand":"4BWpB","../Debug":"7pQt2","./Card":"3Bjwj","./GameSerializationContext":"2ZqlS","./Pile":"cKYbt","./Undoable/CardFlipOperation":"4W2B5","./Undoable/CompoundUndoableOperation":"9gjLd","./Undoable/PileInsertOperation":"fzFKb","./Undoable/PileMaxFanOperation":"6ZlNK","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"4BWpB":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var i=e("./pure-rand-default.js");s.exportAll(i,r),r.default=i},{"./pure-rand-default.js":"8h60f","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"8h60f":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"__type",()=>_),s.export(r,"__version",()=>g),s.export(r,"__commitHash",()=>w),s.export(r,"generateN",()=>i.generateN),s.export(r,"skipN",()=>i.skipN),s.export(r,"unsafeGenerateN",()=>i.unsafeGenerateN),s.export(r,"unsafeSkipN",()=>i.unsafeSkipN),s.export(r,"congruential32",()=>n.congruential32),s.export(r,"mersenne",()=>o.default),s.export(r,"xorshift128plus",()=>l.xorshift128plus),s.export(r,"xoroshiro128plus",()=>d.xoroshiro128plus),s.export(r,"uniformArrayIntDistribution",()=>h.uniformArrayIntDistribution),s.export(r,"uniformBigIntDistribution",()=>u.uniformBigIntDistribution),s.export(r,"uniformIntDistribution",()=>c.uniformIntDistribution),s.export(r,"unsafeUniformArrayIntDistribution",()=>p.unsafeUniformArrayIntDistribution),s.export(r,"unsafeUniformBigIntDistribution",()=>f.unsafeUniformBigIntDistribution),s.export(r,"unsafeUniformIntDistribution",()=>m.unsafeUniformIntDistribution);var i=e("./generator/RandomGenerator.js"),n=e("./generator/LinearCongruential.js"),a=e("./generator/MersenneTwister.js"),o=s.interopDefault(a),l=e("./generator/XorShift.js"),d=e("./generator/XoroShiro.js"),h=e("./distribution/UniformArrayIntDistribution.js"),u=e("./distribution/UniformBigIntDistribution.js"),c=e("./distribution/UniformIntDistribution.js"),p=e("./distribution/UnsafeUniformArrayIntDistribution.js"),f=e("./distribution/UnsafeUniformBigIntDistribution.js"),m=e("./distribution/UnsafeUniformIntDistribution.js"),_="module",g="6.0.2",w="ad3183ba9b712bc6c1c5a9abbb1d1e641db139d4"},{"./generator/RandomGenerator.js":"3VITj","./generator/LinearCongruential.js":"21esJ","./generator/MersenneTwister.js":"l8Ocf","./generator/XorShift.js":"kibGo","./generator/XoroShiro.js":"9fDHQ","./distribution/UniformArrayIntDistribution.js":"iW4Kt","./distribution/UniformBigIntDistribution.js":"3fQCT","./distribution/UniformIntDistribution.js":"fnPID","./distribution/UnsafeUniformArrayIntDistribution.js":"lLf63","./distribution/UnsafeUniformBigIntDistribution.js":"93YAV","./distribution/UnsafeUniformIntDistribution.js":"5r5Ig","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"3VITj":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e,t){for(var r=[],s=0;s!=t;++s)r.push(e.unsafeNext());return r}function n(e,t){var r=e.clone();return[i(r,t),r]}function a(e,t){for(var r=0;r!=t;++r)e.unsafeNext()}function o(e,t){var r=e.clone();return a(r,t),r}s.defineInteropFlag(r),s.export(r,"unsafeGenerateN",()=>i),s.export(r,"generateN",()=>n),s.export(r,"unsafeSkipN",()=>a),s.export(r,"skipN",()=>o)},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"21esJ":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"congruential32",()=>o);var i=function(e){return 214013*e+2531011&4294967295},n=function(e){return(-2147483649&e)>>16},a=function(){function e(e){this.seed=e}return e.prototype.clone=function(){return new e(this.seed)},e.prototype.next=function(){var t=new e(this.seed);return[t.unsafeNext(),t]},e.prototype.unsafeNext=function(){var e=i(this.seed),t=n(e),r=i(e),s=n(r);return this.seed=i(r),0|n(this.seed)+(s+(t<<15)<<15)},e}(),o=function(e){return new a(e)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],l8Ocf:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>function(e){return i.from(e)});var i=function(){function e(e,t){this.states=e,this.index=t}return e.twist=function(t){for(var r=t.slice(),s=0;s!==e.N-e.M;++s){var i=(r[s]&e.MASK_UPPER)+(r[s+1]&e.MASK_LOWER);r[s]=r[s+e.M]^i>>>1^-(1&i)&e.A}for(var s=e.N-e.M;s!==e.N-1;++s){var n=(r[s]&e.MASK_UPPER)+(r[s+1]&e.MASK_LOWER);r[s]=r[s+e.M-e.N]^n>>>1^-(1&n)&e.A}var a=(r[e.N-1]&e.MASK_UPPER)+(r[0]&e.MASK_LOWER);return r[e.N-1]=r[e.M-1]^a>>>1^-(1&a)&e.A,r},e.seeded=function(t){var r=Array(e.N);r[0]=t;for(var s=1;s!==e.N;++s){var i=r[s-1]^r[s-1]>>>30;r[s]=Math.imul(e.F,i)+s|0}return r},e.from=function(t){return new e(e.twist(e.seeded(t)),0)},e.prototype.clone=function(){return new e(this.states,this.index)},e.prototype.next=function(){var t=new e(this.states,this.index);return[t.unsafeNext(),t]},e.prototype.unsafeNext=function(){var t=this.states[this.index];return t^=this.states[this.index]>>>e.U,t^=t<<e.S&e.B,t^=t<<e.T&e.C,t^=t>>>e.L,++this.index>=e.N&&(this.states=e.twist(this.states),this.index=0),t},e.N=624,e.M=397,e.R=31,e.A=2567483615,e.F=1812433253,e.U=11,e.S=7,e.B=2636928640,e.T=15,e.C=4022730752,e.L=18,e.MASK_LOWER=Math.pow(2,e.R)-1,e.MASK_UPPER=Math.pow(2,e.R),e}()},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],kibGo:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"xorshift128plus",()=>n);var i=function(){function e(e,t,r,s){this.s01=e,this.s00=t,this.s11=r,this.s10=s}return e.prototype.clone=function(){return new e(this.s01,this.s00,this.s11,this.s10)},e.prototype.next=function(){var t=new e(this.s01,this.s00,this.s11,this.s10);return[t.unsafeNext(),t]},e.prototype.unsafeNext=function(){var e=this.s00^this.s00<<23,t=this.s01^(this.s01<<23|this.s00>>>9),r=e^this.s10^(e>>>18|t<<14)^(this.s10>>>5|this.s11<<27),s=t^this.s11^t>>>18^this.s11>>>5,i=this.s00+this.s10|0;return this.s01=this.s11,this.s00=this.s10,this.s11=s,this.s10=r,i},e.prototype.jump=function(){var t=new e(this.s01,this.s00,this.s11,this.s10);return t.unsafeJump(),t},e.prototype.unsafeJump=function(){for(var e=0,t=0,r=0,s=0,i=[1667051007,2321340297,1548169110,304075285],n=0;4!==n;++n)for(var a=1;a;a<<=1)i[n]&a&&(e^=this.s01,t^=this.s00,r^=this.s11,s^=this.s10),this.unsafeNext();this.s01=e,this.s00=t,this.s11=r,this.s10=s},e}(),n=function(e){return new i(-1,~e,0|e,0)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"9fDHQ":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"xoroshiro128plus",()=>n);var i=function(){function e(e,t,r,s){this.s01=e,this.s00=t,this.s11=r,this.s10=s}return e.prototype.clone=function(){return new e(this.s01,this.s00,this.s11,this.s10)},e.prototype.next=function(){var t=new e(this.s01,this.s00,this.s11,this.s10);return[t.unsafeNext(),t]},e.prototype.unsafeNext=function(){var e=this.s00+this.s10|0,t=this.s10^this.s00,r=this.s11^this.s01,s=this.s00,i=this.s01;return this.s00=s<<24^i>>>8^t^t<<16,this.s01=i<<24^s>>>8^r^(r<<16|t>>>16),this.s10=r<<5^t>>>27,this.s11=t<<5^r>>>27,e},e.prototype.jump=function(){var t=new e(this.s01,this.s00,this.s11,this.s10);return t.unsafeJump(),t},e.prototype.unsafeJump=function(){for(var e=0,t=0,r=0,s=0,i=[3639956645,3750757012,1261568508,386426335],n=0;4!==n;++n)for(var a=1;a;a<<=1)i[n]&a&&(e^=this.s01,t^=this.s00,r^=this.s11,s^=this.s10),this.unsafeNext();this.s01=e,this.s00=t,this.s11=r,this.s10=s},e}(),n=function(e){return new i(-1,~e,0|e,0)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],iW4Kt:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"uniformArrayIntDistribution",()=>n);var i=e("./UnsafeUniformArrayIntDistribution.js");function n(e,t,r){if(null!=r){var s=r.clone();return[(0,i.unsafeUniformArrayIntDistribution)(e,t,s),s]}return function(r){var s=r.clone();return[(0,i.unsafeUniformArrayIntDistribution)(e,t,s),s]}}},{"./UnsafeUniformArrayIntDistribution.js":"lLf63","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],lLf63:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"unsafeUniformArrayIntDistribution",()=>a);var i=e("./internals/ArrayInt.js"),n=e("./internals/UnsafeUniformArrayIntDistributionInternal.js");function a(e,t,r){var s=(0,i.trimArrayIntInplace)((0,i.addOneToPositiveArrayInt)((0,i.substractArrayIntToNew)(t,e))),a=s.data.slice(0),o=(0,n.unsafeUniformArrayIntDistributionInternal)(a,s.data,r);return(0,i.trimArrayIntInplace)((0,i.addArrayIntToNew)({sign:1,data:o},e))}},{"./internals/ArrayInt.js":"891we","./internals/UnsafeUniformArrayIntDistributionInternal.js":"fxre6","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"891we":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e,t){if(e.sign!==t.sign)return a(e,{sign:-t.sign,data:t.data});for(var r=[],s=0,i=e.data,n=t.data,o=i.length-1,l=n.length-1;o>=0||l>=0;--o,--l){var d=(o>=0?i[o]:0)+(l>=0?n[l]:0)+s;r.push(d>>>0),s=~~(d/4294967296)}return 0!==s&&r.push(s),{sign:e.sign,data:r.reverse()}}function n(e){e.sign=1;for(var t=e.data,r=t.length-1;r>=0;--r)if(4294967295!==t[r])return t[r]+=1,e;else t[r]=0;return t.unshift(1),e}function a(e,t){if(e.sign!==t.sign)return i(e,{sign:-t.sign,data:t.data});var r=e.data,s=t.data;if(function(e,t){for(var r=Math.max(e.length,t.length),s=0;s<r;++s){var i=s+e.length-r,n=s+t.length-r,a=i>=0?e[i]:0,o=n>=0?t[n]:0;if(a<o)return!0;if(a>o)break}return!1}(r,s)){var n=a(t,e);return n.sign=-n.sign,n}for(var o=[],l=0,d=r.length-1,h=s.length-1;d>=0||h>=0;--d,--h){var u=(d>=0?r[d]:0)-(h>=0?s[h]:0)-l;o.push(u>>>0),l=u<0?1:0}return{sign:e.sign,data:o.reverse()}}function o(e){for(var t=e.data,r=0;r!==t.length&&0===t[r];++r);return r===t.length?(e.sign=1,e.data=[0]):t.splice(0,r),e}function l(e,t){if(t<0){var r=-t;e.sign=-1,e.data[0]=~~(r/4294967296),e.data[1]=r>>>0}else e.sign=1,e.data[0]=~~(t/4294967296),e.data[1]=t>>>0;return e}function d(e,t,r){var s=t.data[1],i=t.data[0],n=t.sign,a=r.data[1],o=r.data[0],l=r.sign;if(e.sign=1,1===n&&-1===l){var d=s+a;return e.data[0]=i+o+(d>4294967295?1:0)>>>0,e.data[1]=d>>>0,e}var h=s,u=i,c=a,p=o;-1===n&&(h=a,u=o,c=s,p=i);var f=0,m=h-c;return m<0&&(f=1,m>>>=0),e.data[0]=u-p-f,e.data[1]=m,e}s.defineInteropFlag(r),s.export(r,"addArrayIntToNew",()=>i),s.export(r,"addOneToPositiveArrayInt",()=>n),s.export(r,"substractArrayIntToNew",()=>a),s.export(r,"trimArrayIntInplace",()=>o),s.export(r,"fromNumberToArrayInt64",()=>l),s.export(r,"substractArrayInt64",()=>d)},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],fxre6:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"unsafeUniformArrayIntDistributionInternal",()=>n);var i=e("./UnsafeUniformIntDistributionInternal.js");function n(e,t,r){for(var s=t.length;;){for(var n=0;n!==s;++n){var a=0===n?t[0]+1:4294967296,o=(0,i.unsafeUniformIntDistributionInternal)(a,r);e[n]=o}for(var n=0;n!==s;++n){var l=e[n],d=t[n];if(l<d)return e;if(l>d)break}}}},{"./UnsafeUniformIntDistributionInternal.js":"33eIn","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"33eIn":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e,t){for(var r=e>2?~~(4294967296/e)*e:4294967296,s=t.unsafeNext()+2147483648;s>=r;)s=t.unsafeNext()+2147483648;return s%e}s.defineInteropFlag(r),s.export(r,"unsafeUniformIntDistributionInternal",()=>i)},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"3fQCT":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"uniformBigIntDistribution",()=>n);var i=e("./UnsafeUniformBigIntDistribution.js");function n(e,t,r){if(null!=r){var s=r.clone();return[(0,i.unsafeUniformBigIntDistribution)(e,t,s),s]}return function(r){var s=r.clone();return[(0,i.unsafeUniformBigIntDistribution)(e,t,s),s]}}},{"./UnsafeUniformBigIntDistribution.js":"93YAV","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"93YAV":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"unsafeUniformBigIntDistribution",()=>n);var i="undefined"!=typeof BigInt?BigInt:void 0;function n(e,t,r){for(var s=t-e+i(1),n=i(-2147483648),a=i(4294967296),o=a,l=1;o<s;)o*=a,++l;for(var d=o-o%s;;){for(var h=i(0),u=0;u!==l;++u)h=a*h+(i(r.unsafeNext())-n);if(h<d)return h%s+e}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],fnPID:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"uniformIntDistribution",()=>n);var i=e("./UnsafeUniformIntDistribution.js");function n(e,t,r){if(null!=r){var s=r.clone();return[(0,i.unsafeUniformIntDistribution)(e,t,s),s]}return function(r){var s=r.clone();return[(0,i.unsafeUniformIntDistribution)(e,t,s),s]}}},{"./UnsafeUniformIntDistribution.js":"5r5Ig","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"5r5Ig":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"unsafeUniformIntDistribution",()=>c);var i=e("./internals/UnsafeUniformIntDistributionInternal.js"),n=e("./internals/ArrayInt.js"),a=e("./internals/UnsafeUniformArrayIntDistributionInternal.js"),o=Number.MAX_SAFE_INTEGER,l={sign:1,data:[0,0]},d={sign:1,data:[0,0]},h={sign:1,data:[0,0]},u=[0,0];function c(e,t,r){var s,c=t-e;return c<=4294967295?(0,i.unsafeUniformIntDistributionInternal)(c+1,r)+e:(4294967295===(s=c<=o?(0,n.fromNumberToArrayInt64)(h,c):(0,n.substractArrayInt64)(h,(0,n.fromNumberToArrayInt64)(l,t),(0,n.fromNumberToArrayInt64)(d,e))).data[1]?(s.data[0]+=1,s.data[1]=0):s.data[1]+=1,(0,a.unsafeUniformArrayIntDistributionInternal)(u,s.data,r),4294967296*u[0]+u[1]+e)}},{"./internals/UnsafeUniformIntDistributionInternal.js":"33eIn","./internals/ArrayInt.js":"891we","./internals/UnsafeUniformArrayIntDistributionInternal.js":"fxre6","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"3Bjwj":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"Card",()=>a);var i=e("../Debug"),n=e("./Undoable/CardFlipOperation");class a{game;suit;colour;rank;pile;pileIndex=0;pileChanged=()=>{};pileIndexChanged=()=>{};faceUpChanged=()=>{};faceUp_=!1;get faceUp(){return this.faceUp_}set faceUp(e){if(this.faceUp_===e)return;let t=this.faceUp_,r=new n.CardFlipOperation(this,t,e);this.game.addUndoableOperation(r),r.redo()}doSetFaceUp(e){this.faceUp_=e,this.faceUpChanged()}constructor(e,t,r,s,i,n){this.game=e,this.suit=t,this.colour=r,this.rank=s,this.pile=i,this.pileIndex=n}onPileChanged(e,t){this.pile===e?this.onPileIndexChanged(t):(this.pile=e,this.pileIndex=t,i.assert(this.pileIndex===this.pile.indexOf(this)),this.pileChanged())}onPileIndexChanged(e){this.pileIndex!==e&&(this.pileIndex=e,i.assert(this.pileIndex===this.pile.indexOf(this)),this.pileIndexChanged())}serializeState(e){e.write(this.faceUp?1:0)}deserializeState(e){this.faceUp=0!==e.readRange(0,1)}}},{"../Debug":"7pQt2","./Undoable/CardFlipOperation":"4W2B5","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"4W2B5":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"CardFlipOperation",()=>i);class i{card_;oldFaceUp_;newFaceUp_;static deserializer=e=>i.deserialize(e);constructor(e,t,r){this.card_=e,this.oldFaceUp_=t,this.newFaceUp_=r}undo(){this.card_.doSetFaceUp(this.oldFaceUp_)}redo(){this.card_.doSetFaceUp(this.newFaceUp_)}serialize(e){e.writeCard(this.card_),e.writeBool(this.oldFaceUp_),e.writeBool(this.newFaceUp_)}get deserializer(){return i.deserializer}static deserialize(e){return new i(e.readCard(),e.readBool(),e.readBool())}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"2ZqlS":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GameSerializationContext",()=>o);var i=e("~CardLib/Debug"),n=e("~CardLib/TypeEx"),a=e("../AutoIdMap");class o{data_=[];dataIndex_=0;write(e){this.dataIndex_=this.data_.push(e)}writeBool(e){return this.write(e?1:0)}writeCard(e){this.write(this.getCardId(e))}writePile(e){this.write(this.getPileId(e))}writeUndoable(e){this.writeUndoableDeserializer_(e.deserializer),e.serialize(this)}writeUndoableDeserializer_(e){this.write(this.getUndoableDeserializerId(e))}read(){return this.data_[this.dataIndex_++]??(0,i.error)()}readRange(e,t){let r=this.read();if(r>=e&&r<=t)return r;throw Error(`Value ${r} not in range [${e}, ${t}].`)}readBool(){return 0!==this.readRange(0,1)}readCard(){return this.getCard(this.read())}readPile(){return this.getPile(this.read())}readUndoable(){return this.readUndoableDeserializer_()(this)}readUndoableDeserializer_(){return this.getUndoableDeserializer(this.read())}toJson(){return JSON.stringify(this.data_)}fromJson(e){let t=JSON.parse(e);(0,n.ensureNumberArray)(t),this.data_=t,this.dataIndex_=0}ensureAtEnd(){if(this.dataIndex_!==this.data_.length)throw Error("Deserialization did not consume all data.")}cardMap_=new a.AutoIdMap;addCard(e){return this.cardMap_.add(e)}getCard(e){return this.cardMap_.get(e)}getCardId(e){return this.cardMap_.getId(e)}pileMap_=new a.AutoIdMap;addPile(e){return this.pileMap_.add(e)}getPile(e){return this.pileMap_.get(e)}getPileId(e){return this.pileMap_.getId(e)}undoableDeserializerMap_=new a.AutoIdMap;addUndoableDeserializer(e){return this.undoableDeserializerMap_.add(e)}getUndoableDeserializer(e){return this.undoableDeserializerMap_.get(e)}getUndoableDeserializerId(e){return this.undoableDeserializerMap_.getId(e)}}},{"~CardLib/Debug":"7pQt2","~CardLib/TypeEx":"ghUYK","../AutoIdMap":"lmIdf","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],ghUYK:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"ensureNotUndefined",()=>n),s.export(r,"ensureNumber",()=>a),s.export(r,"ensureString",()=>o),s.export(r,"ensureBoolean",()=>l),s.export(r,"ensureArray",()=>d),s.export(r,"ensureNumberArray",()=>h);var i=e("./Debug");function n(e,t){e||(0,i.error)(t)}function a(e){"number"!=typeof e&&(0,i.error)("Value was not a number.")}function o(e){"string"!=typeof e&&(0,i.error)("Value was not a string.")}function l(e){"boolean"!=typeof e&&(0,i.error)("Value was not a boolean.")}function d(e){e instanceof Array||(0,i.error)("Value was not an array.")}function h(e){for(let t of(d(e),e))a(t)}},{"./Debug":"7pQt2","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],lmIdf:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"AutoIdMap",()=>i);class i{nextId_=0;idToItem_=new Map;itemToId_=new Map;add(e){let t=this.nextId_++;this.idToItem_.set(t,e),this.itemToId_.set(e,t)}get(e){let t=this.idToItem_.get(e);if(!t)throw Error(`Item with id ${e} not found.`);return t}getId(e){let t=this.itemToId_.get(e);if("number"!=typeof t)throw Error("Failed to find id for item.");return t}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],cKYbt:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"Pile",()=>h);var i=e("pure-rand"),n=s.interopDefault(i),a=e("../Debug"),o=e("./Card"),l=e("./Undoable/PileInsertOperation"),d=e("./Undoable/PileMaxFanOperation");class h{game;cardsChanged=()=>{};maxFanChanged=()=>{};cards_=[];get length(){return this.cards_.length}maxFan_=999;get maxFan(){return this.maxFan_}set maxFan(e){if(e=Math.max(0,e),this.maxFan_===e)return;let t=this.maxFan_,r=new d.PileMaxFanOperation(this,t,e);this.game.addUndoableOperation(r),r.redo()}doSetMaxFan(e){this.maxFan_=e,this.maxFanChanged()}constructor(e){this.game=e}*[Symbol.iterator](){for(let e of this.cards_)yield e}createCard(e,t,r){let s=new o.Card(this.game,e,t,r,this,this.length);return this.cards_.push(s),this.cardsChanged(),s}at(e){let t=this.cards_[e]??a.error();return a.assert(t.pile===this),t}slice(e,t){return this.cards_.slice(e,t)}indexOf(e){return this.cards_.indexOf(e)}sort(){this.cards_.sort((e,t)=>e.suit<t.suit?-1:e.suit>t.suit?1:e.colour<t.colour?-1:e.colour>t.colour?1:e.rank<t.rank?-1:e.rank>t.rank?1:0);for(let e=0;e<this.cards_.length;++e)(this.cards_[e]??a.error()).onPileIndexChanged(e);this.cardsChanged()}shuffle(e){for(let t=0;t<this.cards_.length;++t){let r;[r,e]=(0,n.default).uniformIntDistribution(t,this.cards_.length-1,e);let s=this.cards_[t]??a.error();this.cards_[t]=this.cards_[r]??a.error(),this.cards_[r]=s}for(let e=0;e<this.cards_.length;++e)(this.cards_[e]??a.error()).onPileIndexChanged(e);this.cardsChanged()}sortByRank(){this.cards_.sort((e,t)=>e.rank>t.rank?-1:e.rank<t.rank?1:e.colour<t.colour?-1:e.colour>t.colour?1:e.suit<t.suit?-1:e.suit>t.suit?1:0);for(let e=0;e<this.cards_.length;++e)(this.cards_[e]??a.error()).onPileIndexChanged(e);this.cardsChanged()}push(e){return this.insert(this.cards_.length,e)}peek(){if(!(this.cards_.length<=0))return this.at(this.cards_.length-1)}insert(e,t){let r=t.pile,s=t.pileIndex,i=new l.PileInsertOperation(t,r,s,this,e);this.game.addUndoableOperation(i),i.redo()}doInsert(e,t){a.assert(e>=0&&e<=this.cards_.length),t.pile===this&&e>t.pileIndex&&e--,t.pile.remove_(t),this.cards_.splice(e,0,t),t.onPileChanged(this,e);for(let t=e+1;t<this.cards_.length;++t)(this.cards_[t]??a.error()).onPileIndexChanged(t);return this.cardsChanged(),t}remove_(e){a.assert(e.pile===this);let t=e.pileIndex;a.assert(this.at(t)===e),this.cards_.splice(t,1);for(let e=t;e<this.cards_.length;++e)(this.cards_[e]??a.error()).onPileIndexChanged(e);return this.cardsChanged(),e}serializeState(e){for(let t of(e.write(this.maxFan),e.write(this.cards_.length),this.cards_))e.write(e.getCardId(t))}deserializeState(e){this.maxFan=e.readRange(0,999);let t=e.readRange(0,999);for(let r=0;r<t;++r){let t=e.getCard(e.read());this.insert(r,t)}}}},{"pure-rand":"4BWpB","../Debug":"7pQt2","./Card":"3Bjwj","./Undoable/PileInsertOperation":"fzFKb","./Undoable/PileMaxFanOperation":"6ZlNK","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],fzFKb:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"PileInsertOperation",()=>i);class i{card_;oldPile_;oldPileIndex_;newPile_;newPileIndex_;static deserializer=e=>i.deserialize(e);constructor(e,t,r,s,i){this.card_=e,this.oldPile_=t,this.oldPileIndex_=r,this.newPile_=s,this.newPileIndex_=i}undo(){this.oldPile_.doInsert(this.oldPileIndex_,this.card_)}redo(){this.newPile_.doInsert(this.newPileIndex_,this.card_)}serialize(e){e.writeCard(this.card_),e.writePile(this.oldPile_),e.write(this.oldPileIndex_),e.writePile(this.newPile_),e.write(this.newPileIndex_)}get deserializer(){return i.deserializer}static deserialize(e){let t=e.readCard(),r=e.readPile();return new i(t,r,e.read(),e.readPile(),e.read())}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"6ZlNK":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"PileMaxFanOperation",()=>i);class i{pile_;oldMaxFan_;newMaxFan_;static deserializer=e=>i.deserialize(e);constructor(e,t,r){this.pile_=e,this.oldMaxFan_=t,this.newMaxFan_=r}undo(){this.pile_.doSetMaxFan(this.oldMaxFan_)}redo(){this.pile_.doSetMaxFan(this.newMaxFan_)}serialize(e){e.writePile(this.pile_),e.write(this.oldMaxFan_),e.write(this.newMaxFan_)}get deserializer(){return i.deserializer}static deserialize(e){return new i(e.readPile(),e.read(),e.read())}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"9gjLd":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"CompoundUndoableOperation",()=>n);var i=e("~CardLib/Debug");class n{static deserializer=e=>n.deserialize(e);ops_=[];get length(){return this.ops_.length}addOperation(e){this.ops_.push(e)}undo(){for(let e=this.ops_.length;e-- >0;)(this.ops_[e]??(0,i.error)()).undo()}redo(){for(let e of this.ops_)e.redo()}serialize(e){for(let t of(e.write(this.ops_.length),this.ops_))e.writeUndoable(t)}get deserializer(){return n.deserializer}static deserialize(e){let t=new n,r=e.read();for(let s=0;s<r;++s)t.addOperation(e.readUndoable());return t}}},{"~CardLib/Debug":"7pQt2","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"3ngPc":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GameOptions",()=>o);var i=e("~CardLib/MathEx"),n=e("~CardLib/Model/GameOptionsBase"),a=e("~CardLib/URLSearchParamsEx");class o extends n.GameOptionsBase{stockDraws=1;restocksAllowed=1/0;autoReveal=!0;autoPlayStock=!0;autoMoveToFoundation=2;get saveKey(){return{stockDraws:this.stockDraws,restocksAllowed:this.restocksAllowed}}constructor(e){super(),this.stockDraws=i.clamp(a.getNumber(e,"stockDraws",1),1,5),this.restocksAllowed=a.getNumber(e,"restocksAllowed",1/0),this.autoReveal=a.getBool(e,"autoReveal",!0),this.autoPlayStock=a.getBool(e,"autoPlayStock",!0),this.autoMoveToFoundation=Math.max(0,a.getNumber(e,"autoMoveToFoundation",2))}toURLSearchParams(){let e=new URLSearchParams;return a.setNumber(e,"stockDraws",this.stockDraws,1),a.setNumber(e,"restocksAllowed",this.restocksAllowed,1/0),a.setBool(e,"autoReveal",this.autoReveal,!0),a.setBool(e,"autoPlayStock",this.autoPlayStock,!0),a.setNumber(e,"autoMoveToFoundation",this.autoMoveToFoundation,2),e}}},{"~CardLib/MathEx":"h275p","~CardLib/Model/GameOptionsBase":"lqBub","~CardLib/URLSearchParamsEx":"67OEU","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],h275p:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e,t,r){return e<=t?t:e>=r?r:e}function n(e){return e<=0?0:e>=1?1:e}function a(e,t,r){return e!==t?n((r-e)/(t-e)):0}function o(e,t,r){return e+(t-e)*n(r)}s.defineInteropFlag(r),s.export(r,"clamp",()=>i),s.export(r,"clamp01",()=>n),s.export(r,"inverseLerp",()=>a),s.export(r,"lerp",()=>o)},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],lqBub:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GameOptionsBase",()=>i);class i{}},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"67OEU":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e,t,r){let s=e.get(t);if("string"!=typeof s||""===s)return r;let i=Number(s);return Number.isNaN(i)?r:i}function n(e,t,r,s){r!==s&&e.set(t,r.toString())}function a(e,t,r){let s=e.get(t);return"string"!=typeof s?r:""===s||!!s}function o(e,t,r,s){r!==s&&e.set(t,(r?1:0).toString())}s.defineInteropFlag(r),s.export(r,"getNumber",()=>i),s.export(r,"setNumber",()=>n),s.export(r,"getBool",()=>a),s.export(r,"setBool",()=>o)},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"680f9":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GamePresenter",()=>o);var i=e("~CardLib/Debug"),n=e("~CardLib/Presenter/GamePresenterBase"),a=e("~CardLib/View/Rect");class o extends n.GamePresenterBase{stockPile_;wastePile_;foundationPiles_=[];tableauPiles_=[];get saveDataKey_(){return JSON.stringify({gameName:"klondike",version:0,options:this.game_.options.saveKey})}constructor(e,t){super(e,t);{let t=this.createPileView_(e.stock);t.showFrame=!0,this.stockPile_=t}{let t=this.createPileView_(e.waste);t.showFrame=!0,t.zIndex=50,t.fanXUp=3,this.wastePile_=t}for(let t=0;t<this.game_.foundations.length;++t){let r=this.createPileView_(e.foundations[t]??(0,i.error)());r.showFrame=!0,r.zIndex=800,this.foundationPiles_.push(r)}for(let t=0;t<this.game_.tableaux.length;++t){let r=this.createPileView_(e.tableaux[t]??(0,i.error)());r.showFrame=!0,r.zIndex=800,this.tableauPiles_.push(r)}for(let t of e.cards)this.createCardView_(t);this.layoutPiles_(),this.relayoutAll_()}onResize_(){this.layoutPiles_(),this.relayoutAll_()}layoutPiles_(){let e=this.game_.tableaux.length,t=1;window.matchMedia("screen and (max-aspect-ratio: 100/130)").matches&&(t=1.5);let r=t=>(t-.5*(e-1))*13.85714285714745;{let e=this.game_.stock;this.getPileView_(e).rect=new a.Rect(12.85714285714745,20,r(0),-35*t+1)}this.game_.waste,this.getPileView_(this.game_.waste).rect=new a.Rect(12.85714285714745,20,r(1),-35*t+1);for(let s=0;s<this.game_.foundations.length;++s){let n=this.game_.foundations[s]??(0,i.error)();this.getPileView_(n).rect=new a.Rect(12.85714285714745,20,r(e-this.game_.foundations.length+s),-35*t+1)}for(let e=0;e<this.game_.tableaux.length;++e){let s=this.game_.tableaux[e]??(0,i.error)(),n=this.getPileView_(s);n.rect=new a.Rect(12.85714285714745,20,r(e),-35*t+1+1+20+1),n.fanYDown=3.5,n.fanYUp=3.5*t}}}},{"~CardLib/Debug":"7pQt2","~CardLib/Presenter/GamePresenterBase":"aBmck","~CardLib/View/Rect":"aOPAi","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],aBmck:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GamePresenterBase",()=>l);var i=e("../Debug"),n=e("../Model/DelayHint"),a=e("../View/CardView"),o=e("../View/PileView");class l{game_;rootView_;newGameButton_=document.getElementById("newGameButton");undoButton_=document.getElementById("undoButton");redoButton_=document.getElementById("redoButton");constructor(e,t){this.game_=e,this.rootView_=t,e.wonChanged=()=>{this.gameWonChanged_()};let r=t.element.querySelector(".gameScore");r&&(e.gamesStartedChanged=e.gamesWonChanged=()=>{let t=e.won?e.gamesStarted:e.gamesStarted-1,s=t>0?(100*e.gamesWon/t).toFixed(2):"0";r.textContent=`${e.gamesWon} / ${t} - ${s}%`}),this.newGameButton_?.addEventListener("click",this.onNewGameButtonClick_),this.undoButton_?.addEventListener("click",this.onUndoButtonClick_),this.redoButton_?.addEventListener("click",this.onRedoButtonClick_),window.addEventListener("resize",this.onWindowResize_),window.addEventListener("keydown",this.onWindowKeyDown_)}dispose(){this.rootView_.dispose(),this.newGameButton_?.removeEventListener("click",this.onNewGameButtonClick_),this.undoButton_?.removeEventListener("click",this.onUndoButtonClick_),this.redoButton_?.removeEventListener("click",this.onRedoButtonClick_),window.removeEventListener("resize",this.onWindowResize_),window.removeEventListener("keydown",this.onWindowKeyDown_)}start(){let e=window.localStorage.getItem(this.saveDataKey_);e&&this.game_.deserialize(e)||this.restart_()}async gameWonChanged_(){if(this.game_.won){let e=0,t=this.game_.wonCards;for(let e of t){if(!this.game_.won)break;this.getCardView_(e).zIndex=this.getNextZIndex_()}await this.waitForDelay_(n.DelayHint.Settle,e++);for(let r=t.length;r-- >0;){let s=t[r]??i.error();if(!this.game_.won)break;let a=this.getCardView_(s);a.won=!0;let o=a.rect;o.x=100*Math.random()-50,o.y=100*Math.random()-50,a.rect=o,await this.waitForDelay_(n.DelayHint.Settle,e++)}}else for(let e of this.cardViews_)e.won=!1}relayoutAll_(){for(let e of this.game_.piles){let t=this.getPileView_(e);this.relayoutPile_(t,e)}for(let e of this.game_.cards)this.getCardView_(e).faceUp=e.faceUp}pileViews_=[];pileToPileView_=new Map;pileViewtoPile_=new Map;createPileView_(e){let t=new o.PileView(this.rootView_);return this.pileViews_.push(t),this.pileToPileView_.set(e,t),this.pileViewtoPile_.set(t,e),e.cardsChanged=()=>this.onPileCardsChanged_(t,e),e.maxFanChanged=()=>this.onPileMaxFanChanged_(t,e),t.click=()=>this.pilePrimary_(e),t.dblClick=()=>this.pileSecondary_(e),t}getPile_(e){let t=this.pileViewtoPile_.get(e);return t||i.error(),t}getPileView_(e){let t=this.pileToPileView_.get(e);return t||i.error(),t}onPileCardsChanged_(e,t){this.relayoutPile_(e,t)}onPileMaxFanChanged_(e,t){this.relayoutPile_(e,t)}relayoutPile_(e,t){let r;e.cardCount=t.length;for(let e=t.length;e-- >0;){let s=t.at(e),i=this.getCardView_(s);r?i.zIndex=--r:r=i.zIndex}let s=t.length-t.maxFan,i=0,n=0,a=0,o=0;for(let r=0;r<t.length;++r){let l=t.at(r),d=this.getCardView_(l),h=e.rect;i=a,n=o,h.x+=a,h.y+=o,r>=s&&(l.faceUp?(a+=e.fanXUp,o+=e.fanYUp):(a+=e.fanXDown,o+=e.fanYDown)),d.rect=h}let l=e.rect;l.x+=.5*i,l.y+=.5*n,l.sizeX+=i,l.sizeY+=n,e.hitbox=l}cardViews_=[];cardToCardView_=new Map;cardViewtoCard_=new Map;createCardView_(e){let t=new a.CardView(this.rootView_,e.suit,e.colour,e.rank);return this.cardViews_.push(t),this.cardToCardView_.set(e,t),this.cardViewtoCard_.set(t,e),this.onCardPileChanged_(t,e),e.pileChanged=()=>this.onCardPileChanged_(t,e),this.onCardPileIndexChanged_(t,e),e.pileIndexChanged=()=>this.onCardPileIndexChanged_(t,e),this.onCardFaceUpChanged_(t,e),e.faceUpChanged=()=>this.onCardFaceUpChanged_(t,e),t.click=()=>this.cardPrimary_(e),t.dblClick=()=>this.cardSecondary_(e),t.dragStart=()=>this.cardDragStart_(t,e),t.dragMoved=r=>this.cardDragMoved_(t,e,r),t.dragEnd=(r,s)=>this.cardDragEnd_(t,e,r,s),t}getCard_(e){let t=this.cardViewtoCard_.get(e);return t||i.error(),t}getCardView_(e){let t=this.cardToCardView_.get(e);return t||i.error(),t}onCardPileChanged_(e,t){e.zIndex=this.getNextZIndex_()}onCardPileIndexChanged_(e,t){}onCardFaceUpChanged_(e,t){e.faceUp=t.faceUp}cardDragStart_(e,t){let{canDrag:r,extraCards:s}=this.game_.canDrag(t),i=this.getNextZIndex_();if(r){e.zIndex=i;for(let e=t.pileIndex+1;e<t.pile.length;++e){let r=t.pile.at(e),s=this.getCardView_(r);s.zIndex<i&&(s.zIndex=this.getNextZIndex_())}}let n=[];for(let e of s){let t=this.getCardView_(e);n.push(t),r&&t.zIndex<i&&(t.zIndex=this.getNextZIndex_())}return{canDrag:r,extraCardViews:n}}cardDragMoved_(e,t,r){let s=this.getBestDragPile_(t,r);if(s){let e=s.peek();if(e){let t=this.getCardView_(e);this.setDropPreview_(t);return}{let e=this.getPileView_(s);this.setDropPreview_(e);return}}this.setDropPreview_(void 0)}cardDragEnd_(e,t,r,s){if(!s){let e=this.getBestDragPile_(t,r);e&&this.doOperation_(()=>this.game_.dropCard(t,e))}this.setDropPreview_(void 0)}getBestDragPile_(e,t){let r;let s=0;for(let i of this.pileViews_){let n=this.getPile_(i),a=i.hitbox,o=t.overlaps(a);!(o<=0)&&(!r||s<o)&&this.game_.previewDrop(e,n)&&(r=n,s=o)}return r}dropPreview_=void 0;setDropPreview_(e){e!==this.dropPreview_&&(this.dropPreview_&&(this.dropPreview_.dropPreview=!1),this.dropPreview_=e,this.dropPreview_&&(this.dropPreview_.dropPreview=!0))}nextZIndex_=1e3;nextZIndexInc_=1;getNextZIndex_(){let e=this.nextZIndex_;return this.nextZIndex_+=this.nextZIndexInc_,e}onNewGameButtonClick_=e=>{e.preventDefault(),this.restart_()};onUndoButtonClick_=e=>{e.preventDefault(),this.undo_()};onRedoButtonClick_=e=>{e.preventDefault(),this.redo_()};onWindowResize_=e=>{this.onResize_()};onWindowKeyDown_=e=>{"y"===e.key&&e.ctrlKey?(this.redo_(),e.stopPropagation(),e.preventDefault()):"z"===e.key&&e.ctrlKey?(this.undo_(),e.stopPropagation(),e.preventDefault()):"n"===e.key&&(this.restart_(),e.stopPropagation(),e.preventDefault())};undo_(){this.doOperation_(()=>this.game_.undo())}redo_(){this.doOperation_(()=>this.game_.redo())}restart_(){this.doOperation_(()=>this.game_.restart(Date.now()))}pilePrimary_(e){this.doOperation_(()=>this.game_.pilePrimary(e))}pileSecondary_(e){this.doOperation_(()=>this.game_.pileSecondary(e))}cardPrimary_(e){this.doOperation_(()=>this.game_.cardPrimary(e))}cardSecondary_(e){this.doOperation_(()=>this.game_.cardSecondary(e))}operations_=[];async doOperation_(e){if(this.operations_.push(e),1===this.operations_.length)for(;this.operations_.length>0;){let e=0;for(let t of(this.operations_[0]??i.error())())this.operations_.length>1&&(e=Math.max(200,e)),await this.waitForDelay_(t,e++);this.operations_.shift();try{window.localStorage.setItem(this.saveDataKey_,this.game_.serialize())}catch(e){console.error("Failed to serialize game state.",e)}}}async waitForDelay_(e,t){let r=Math.pow(.99,t);switch(e){case n.DelayHint.None:return;case n.DelayHint.Quick:await new Promise(e=>setTimeout(e,20*r));return;case n.DelayHint.OneByOne:await new Promise(e=>setTimeout(e,200*r));return;case n.DelayHint.Settle:await new Promise(e=>setTimeout(e,400*r));return}}}},{"../Debug":"7pQt2","../Model/DelayHint":"lTDNY","../View/CardView":"04Bz0","../View/PileView":"lsOBJ","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"04Bz0":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"CardView",()=>o);var i=e("./Rect"),n=e("./ViewContext"),a=e("./ViewUtils");class o{context;element;click=()=>{};dblClick=()=>{};dragStart=()=>({canDrag:!1,extraCardViews:[]});dragMoved=e=>{};dragEnd=(e,t)=>{};rect_=new i.Rect;get rect(){let e=new i.Rect;return e.set(this.rect_),e}set rect(e){this.rect_.set(e)&&e.setOnElement(this.element)}zIndex_=0;get zIndex(){return this.zIndex_}set zIndex(e){this.zIndex_!==e&&(this.zIndex_=e,this.element.style.zIndex=`${e}`)}faceUp_=!1;get faceUp(){return this.faceUp_}set faceUp(e){this.faceUp_!==e&&(this.faceUp_=e,e?this.element.classList.add("faceUp"):this.element.classList.remove("faceUp"))}won_=!1;get won(){return this.won_}set won(e){this.won_!==e&&(this.won_=e,e?this.element.classList.add("won"):this.element.classList.remove("won"))}dropPreview_=!1;get dropPreview(){return this.dropPreview_}set dropPreview(e){this.dropPreview_!==e&&(this.dropPreview_=e,e?this.element.classList.add("dropPreview"):this.element.classList.remove("dropPreview"))}constructor(e,t,r,s){this.context=e.context,this.element=(0,a.instantiateTemplate)(e.element,"cardViewTemplate"),this.element.classList.add(`s${t}c${r}r${s}`),this.element.addEventListener("mousedown",this.onMouseDown_),this.element.addEventListener("touchstart",this.touchStart_)}dispose(){this.element.removeEventListener("mousedown",this.onMouseDown_),this.element.removeEventListener("touchstart",this.touchStart_),this.element.remove()}touchTracking_=!1;touchId_=0;touchInDeadZone_=!1;touchStartX_=0;touchStartY_=0;lastTouchEndTimeStamp_=0;onTouchDown(e,t,r,s){this.touchTracking_||(this.touchId_=e,this.touchTracking_=!0,this.touchInDeadZone_=!0,this.touchStartX_=t,this.touchStartY_=r,this.dragging_=!1)}onTouchMoved(e,t,r,s){if(this.touchTracking_&&this.touchId_===e){let e=t-this.touchStartX_,s=r-this.touchStartY_;if(this.touchInDeadZone_){let t=e*e+s*s;if(t>n.ViewContext.TOUCH_DEADZONE_SQ){let r=Math.sqrt(t);e/=r,s/=r,this.touchStartX_+=n.ViewContext.TOUCH_DEADZONE*e,this.touchStartY_+=n.ViewContext.TOUCH_DEADZONE*s,this.touchInDeadZone_=!1,this.startDragging_()}}if(this.dragging_){this.touchStartX_=t,this.touchStartY_=r;let i=this.context.pxPerRem;for(let t of(this.dragRect_.x+=i*e,this.dragRect_.y+=i*s,this.dragRect_.setOnElement(this.element),this.dragExtraCardViews_))t.dragRect_.x+=i*e,t.dragRect_.y+=i*s,t.dragRect_.setOnElement(t.element);this.dragMoved(this.dragRect_)}}}onTouchUp(e,t,r){this.touchTracking_&&this.touchId_===e&&(this.touchTracking_=!1,this.context.removeTouchResponder(this),this.touchInDeadZone_?(r<this.lastTouchEndTimeStamp_+1e3?this.dblClick():(this.lastTouchEndTimeStamp_=r,this.click()),this.stopDragging_(!0)):this.stopDragging_(!1))}dragging_=!1;dragExtraCardViews_=[];dragRect_=new i.Rect;startDragging_(){let{canDrag:e,extraCardViews:t}=this.dragStart();if(e)for(let e of(this.dragging_=!0,this.dragExtraCardViews_=t,this.dragRect_.set(this.rect_),this.element.classList.add("dragging"),this.dragExtraCardViews_))e.dragRect_.set(e.rect_),e.element.classList.add("dragging")}stopDragging_(e){if(this.dragging_){for(let e of(this.dragging_=!1,this.element.classList.remove("dragging"),this.rect_.setOnElement(this.element),this.dragExtraCardViews_))e.element.classList.remove("dragging"),e.rect_.setOnElement(e.element);this.dragEnd(this.dragRect_,e)}}onMouseDown_=e=>{0===e.button&&(e.preventDefault(),this.context.addTouchResponder(this),this.onTouchDown(-1,e.pageX,e.pageY,e.timeStamp))};touchStart_=e=>{for(let t=0;t<e.changedTouches.length;++t){let r=e.changedTouches.item(t);r&&(e.preventDefault(),this.context.addTouchResponder(this),this.onTouchDown(r.identifier,r.pageX,r.pageY,e.timeStamp))}}}},{"./Rect":"aOPAi","./ViewContext":"lj9AI","./ViewUtils":"9XVxt","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],aOPAi:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"Rect",()=>i);class i{sizeX;sizeY;x;y;constructor(e=0,t=0,r=0,s=0){this.sizeX=e,this.sizeY=t,this.x=r,this.y=s}get xMin(){return this.x-.5*this.sizeX}set xMin(e){let t=this.xMax;this.sizeX=t-e,this.x=.5*e+.5*t}get xMax(){return this.x+.5*this.sizeX}set xMax(e){let t=this.xMin;this.sizeX=e-t,this.x=.5*t+.5*e}get yMin(){return this.y-.5*this.sizeY}set yMin(e){let t=this.yMax;this.sizeX=t-e,this.y=.5*e+.5*t}get yMax(){return this.y+.5*this.sizeY}set yMax(e){let t=this.yMin;this.sizeX=e-t,this.y=.5*t+.5*e}set(e){return!this.equals(e)&&(this.x=e.x,this.y=e.y,this.sizeX=e.sizeX,this.sizeY=e.sizeY,!0)}setOnElement(e){e.style.left=`calc(50% + ${this.x-.5*this.sizeX}em)`,e.style.right=`calc(50% + ${-this.x-.5*this.sizeX}em)`,e.style.top=`calc(50% + ${this.y-.5*this.sizeY}em)`,e.style.bottom=`calc(50% + ${-this.y-.5*this.sizeY}em)`}equals(e){return this.x===e.x&&this.y===e.y&&this.sizeX===e.sizeX&&this.sizeY===e.sizeY}overlaps(e){let t=Math.min(this.xMax,e.xMax)-Math.max(this.xMin,e.xMin);if(t<=0)return 0;let r=Math.min(this.yMax,e.yMax)-Math.max(this.yMin,e.yMin);return r<=0?0:t*r}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],lsOBJ:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"PileView",()=>o);var i=e("./Rect"),n=e("./ViewContext"),a=e("./ViewUtils");class o{context;element;click=()=>{};dblClick=()=>{};fanXDown=0;fanXUp=0;fanYDown=0;fanYUp=0;cardCount=0;rect_=new i.Rect;get rect(){let e=new i.Rect;return e.set(this.rect_),e}set rect(e){this.rect_.set(e)&&e.setOnElement(this.element)}hitbox_=new i.Rect;get hitbox(){let e=new i.Rect;return e.set(this.hitbox_),e}set hitbox(e){this.hitbox_.set(e)}zIndex_=0;get zIndex(){return this.zIndex_}set zIndex(e){this.zIndex_!==e&&(this.zIndex_=e,this.element.style.zIndex=`${e}`)}showFrame_=!1;get showFrame(){return this.showFrame_}set showFrame(e){this.showFrame_!==e&&(this.showFrame_=e,e?this.element.classList.add("showFrame"):this.element.classList.remove("showFrame"))}dropPreview_=!1;get dropPreview(){return this.dropPreview_}set dropPreview(e){this.dropPreview_!==e&&(this.dropPreview_=e,e?this.element.classList.add("dropPreview"):this.element.classList.remove("dropPreview"))}constructor(e){this.context=e.context,this.element=(0,a.instantiateTemplate)(e.element,"pileViewTemplate"),this.element.addEventListener("mousedown",this.onMouseDown_),this.element.addEventListener("touchstart",this.touchStart_)}dispose(){this.element.removeEventListener("mousedown",this.onMouseDown_),this.element.removeEventListener("touchstart",this.touchStart_),this.element.remove()}touchTracking_=!1;touchId_=0;touchInDeadZone_=!1;touchStartX_=0;touchStartY_=0;lastTouchEndTimeStamp_=0;onTouchDown(e,t,r,s){this.touchTracking_||(this.touchId_=e,this.touchTracking_=!0,this.touchInDeadZone_=!0,this.touchStartX_=t,this.touchStartY_=r)}onTouchMoved(e,t,r,s){if(this.touchTracking_&&this.touchId_===e){let e=t-this.touchStartX_,s=r-this.touchStartY_;if(this.touchInDeadZone_){let t=e*e+s*s;if(t>n.ViewContext.TOUCH_DEADZONE_SQ){let r=Math.sqrt(t);e/=r,s/=r,this.touchStartX_+=n.ViewContext.TOUCH_DEADZONE*e,this.touchStartY_+=n.ViewContext.TOUCH_DEADZONE*s,this.touchInDeadZone_=!1}}}}onTouchUp(e,t,r){this.touchTracking_&&this.touchId_===e&&(this.touchTracking_=!1,this.context.removeTouchResponder(this),this.touchInDeadZone_&&(r<this.lastTouchEndTimeStamp_+1e3?(this.dblClick(),this.lastTouchEndTimeStamp_=r):this.click()))}onMouseDown_=e=>{0===e.button&&(e.preventDefault(),this.context.addTouchResponder(this),this.onTouchDown(-1,e.pageX,e.pageY,e.timeStamp))};touchStart_=e=>{for(let t=0;t<e.changedTouches.length;++t){let r=e.changedTouches.item(t);r&&(e.preventDefault(),this.context.addTouchResponder(this),this.onTouchDown(r.identifier,r.pageX,r.pageY,e.timeStamp))}}}},{"./Rect":"aOPAi","./ViewContext":"lj9AI","./ViewUtils":"9XVxt","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"2W9ph":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);var s=e("./Presenter/GamePresenterFactory");class i{gameId="klondikeex";gameName="Klondike Ex";gamePresenterFactory=new s.GamePresenterFactory}r.default=new i},{"./Presenter/GamePresenterFactory":"e1cxm","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],e1cxm:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GAME_ID",()=>l),s.export(r,"GamePresenterFactory",()=>d);var i=e("~CardLib/View/RootView"),n=e("../Model/Game"),a=e("../Model/GameOptions"),o=e("./GamePresenter");let l="klondike";class d{createGame(e,t){let r=new a.GameOptions(t),s=new n.Game(r),l=new i.RootView(e);return new o.GamePresenter(s,l)}}},{"~CardLib/View/RootView":"feB3F","../Model/Game":"7gOt6","../Model/GameOptions":"gpEXZ","./GamePresenter":"kYCgP","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"7gOt6":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"Game",()=>h);var i=e("~CardLib/Debug"),n=e("~CardLib/Model/DeckUtils"),a=e("~CardLib/Model/DelayHint"),o=e("~CardLib/Model/GameBase"),l=e("~CardLib/Model/Pile"),d=e("~CardLib/Model/Rank");class h extends o.GameBase{options;stock=new l.Pile(this);foundations=[];tableaux=[];dragSingleSources_=[];dragAnySources_=[];autoMoveSources_=[];autoMoveAnySources_=[];restocks_=0;constructor(e){super(),this.options=e,this.piles.push(this.stock),this.dragAnySources_.push(this.stock),this.autoMoveAnySources_.push(this.stock);for(let e=0;e<4;++e){let e=new l.Pile(this);this.foundations.push(e),this.dragSingleSources_.push(e),this.piles.push(e)}for(let e=0;e<7;++e){let e=new l.Pile(this);this.tableaux.push(e),this.dragSingleSources_.push(e),this.autoMoveSources_.push(e),this.piles.push(e)}this.cards=n.createStandard52Deck(this.stock)}doGetWon_(){let e=0;for(let t of this.foundations)e+=t.length;return 52===e}get wonCards(){let e=[];for(let t of this.foundations)for(let r of t)e.push(r);return e.sort((e,t)=>e.pileIndex>t.pileIndex?1:e.pileIndex<t.pileIndex?-1:e.rank>t.rank?1:e.rank<t.rank?-1:0),e}*restart_(e){for(let e of(this.restocks_=0,this.stock.maxFan=0,this.stock))e.faceUp=!1;for(let e=this.piles.length;e-- >0;){let t=this.piles[e]??i.error();if(t!==this.stock)for(let e=t.length;e-- >0;){let r=t.at(e);r.faceUp=!1,this.stock.push(r)}}this.stock.sort(),this.stock.shuffle(e),yield a.DelayHint.Settle;for(let e=0;e<this.tableaux.length;++e){let t=this.tableaux[e]??i.error();for(let r=0;r<=e;++r){let e=this.stock.peek();e&&(t.push(e),yield a.DelayHint.Quick)}}this.stock.sortByRank();for(let e=this.stock.length;e-- >0;)this.stock.at(e).faceUp=!0;this.stock.maxFan=999,yield a.DelayHint.OneByOne,yield*this.doAutoMoves_()}*cardPrimary_(e){if(this.tableaux.indexOf(e.pile)&&e.pile.peek()===e&&!e.faceUp){e.faceUp=!0,yield a.DelayHint.OneByOne,yield*this.doAutoMoves_();return}}*cardSecondary_(e){if(this.isFoundationDropSource_(e)){for(let t of this.foundations)if(this.isFoundationDrop_(e,t)){yield*this.doFoundationDrop_(e,t),yield*this.doAutoMoves_();return}}if(this.isTableauxDropSource_(e)){for(let t of this.tableaux)if(t!==e.pile&&this.isTableauxDrop_(e,t)){yield*this.doTableauxDrop_(e,t),yield*this.doAutoMoves_();return}}if(this.isTableauxSingleDropSource_(e)){for(let t of this.tableaux)if(t!==e.pile&&this.isTableauxSingleDrop_(e,t)){yield*this.doTableauxSingleDrop_(e,t),yield*this.doAutoMoves_();return}}}*pilePrimary_(e){}*pileSecondary_(e){}canDrag_(e){return this.isFoundationDropSource_(e)||this.isTableauxSingleDropSource_(e)?{canDrag:!0,extraCards:[]}:this.isTableauxDropSource_(e)?{canDrag:!0,extraCards:e.pile.slice(e.pileIndex+1)}:{canDrag:!1,extraCards:[]}}previewDrop_(e,t){return this.isTableauxDrop_(e,t)||this.isFoundationDrop_(e,t)||this.isTableauxSingleDrop_(e,t)}*dropCard_(e,t){this.isTableauxDrop_(e,t)?(yield*this.doTableauxDrop_(e,t),yield*this.doAutoMoves_()):this.isFoundationDrop_(e,t)?(yield*this.doFoundationDrop_(e,t),yield*this.doAutoMoves_()):this.isTableauxSingleDrop_(e,t)&&(yield*this.doTableauxSingleDrop_(e,t),yield*this.doAutoMoves_())}isTableauxDrop_(e,t){if(e.pile===t||!this.isTableauxDropSource_(e))return!1;if(this.tableaux.indexOf(t)>=0){let r=t.peek();if(r){if(this.getCardValue_(r)===this.getCardValue_(e)+1&&r.colour!==e.colour)return!0}else if(e.rank===d.Rank.King)return!0}return!1}isTableauxDropSource_(e){if(this.tableaux.indexOf(e.pile)>=0&&e.pile.peek()?.faceUp)for(let t=e.pile.length-1;t-- >0;){let r=e.pile.at(t),s=e.pile.at(t+1);if(r.faceUp&&s.faceUp&&r.colour!==s.colour&&this.getCardValue_(s)===this.getCardValue_(r)-1){if(r===e)return!0}else break}return!1}*doTableauxDrop_(e,t){for(let r of(e.pile,e.pile.slice(e.pileIndex)))t.push(r);yield a.DelayHint.OneByOne}isTableauxSingleDrop_(e,t){if(e.pile===t||!this.isTableauxSingleDropSource_(e))return!1;if(this.tableaux.indexOf(t)>=0){let r=t.peek();if(r){if(this.getCardValue_(r)===this.getCardValue_(e)+1&&r.colour!==e.colour)return!0}else if(e.rank===d.Rank.King)return!0}return!1}isTableauxSingleDropSource_(e){return this.dragSingleSources_.indexOf(e.pile)>=0&&e.pile.peek()===e&&e.faceUp||this.dragAnySources_.indexOf(e.pile)>=0&&e.faceUp}*doTableauxSingleDrop_(e,t){t.push(e),yield a.DelayHint.OneByOne}isFoundationDrop_(e,t){if(e.pile===t||!this.isFoundationDropSource_(e))return!1;if(this.foundations.indexOf(t)>=0){let r=t.peek();if(r){if(this.getCardValue_(r)+1===this.getCardValue_(e)&&r.suit===e.suit)return!0}else if(e.rank===d.Rank.Ace)return!0}return!1}isFoundationDropSource_(e){return this.dragSingleSources_.indexOf(e.pile)>=0&&e.pile.peek()===e&&e.faceUp||this.dragAnySources_.indexOf(e.pile)>=0&&e.faceUp}*doFoundationDrop_(e,t){t.push(e),yield a.DelayHint.OneByOne}getCardValue_(e){switch(e.rank){case d.Rank.Ace:return 1;case d.Rank.Two:return 2;case d.Rank.Three:return 3;case d.Rank.Four:return 4;case d.Rank.Five:return 5;case d.Rank.Six:return 6;case d.Rank.Seven:return 7;case d.Rank.Eight:return 8;case d.Rank.Nine:return 9;case d.Rank.Ten:return 10;case d.Rank.Jack:return 11;case d.Rank.Queen:return 12;case d.Rank.King:return 13;default:i.error()}}*doAutoMoves_(){e:for(;;){if(this.options.autoReveal)for(let e of this.tableaux){let t=e.peek();if(t&&!t.faceUp){t.faceUp=!0,yield a.DelayHint.OneByOne;continue e}}if(this.options.autoMoveToFoundation>0){let e=999;for(let t of this.foundations){let r=t.peek();e=r?Math.min(e,this.getCardValue_(r)):Math.min(e,0)}for(let t of this.autoMoveSources_){let r=t.peek();if(r&&this.getCardValue_(r)<=e+this.options.autoMoveToFoundation){for(let e of this.foundations)if(this.previewDrop_(r,e)){yield*this.dropCard_(r,e);continue e}}}for(let t of this.autoMoveAnySources_)for(let r=t.length;r-- >0;){let s=t.at(r);if(this.getCardValue_(s)<=e+this.options.autoMoveToFoundation){for(let e of this.foundations)if(this.previewDrop_(s,e)){yield*this.dropCard_(s,e);continue e}}}}if(this.options.autoCollateKings){let e=[],t=0;for(let r of this.tableaux)if(r.length>0){let s=r.at(0);s&&s.rank===d.Rank.King&&s.faceUp&&(e.push(r),t=Math.max(t,13-r.length))}for(let r of this.tableaux)e.length<4&&0===r.length&&(e.push(r),t=Math.max(t,13-r.length));if(4===e.length&&t>=3){for(let r of this.autoMoveSources_)if(!(e.indexOf(r)>=0)){for(let s of r)if(s.faceUp&&this.getCardValue_(s)===t){for(let t of e)if(this.previewDrop_(s,t)){yield*this.dropCard_(s,t);continue e}}}for(let r of this.autoMoveAnySources_)for(let s=r.length;s-- >0;){let i=r.at(s);if(this.getCardValue_(i)===t){for(let t of e)if(this.previewDrop_(i,t)){yield*this.dropCard_(i,t);continue e}}}}}break}}}},{"~CardLib/Debug":"7pQt2","~CardLib/Model/DeckUtils":"kDLU7","~CardLib/Model/DelayHint":"lTDNY","~CardLib/Model/GameBase":"bxQph","~CardLib/Model/Pile":"cKYbt","~CardLib/Model/Rank":"63AzX","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],gpEXZ:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GameOptions",()=>a);var i=e("~CardLib/Model/GameOptionsBase"),n=e("~CardLib/URLSearchParamsEx");class a extends i.GameOptionsBase{autoReveal=!0;autoMoveToFoundation=2;autoCollateKings=!0;get saveKey(){return{}}constructor(e){super(),this.autoReveal=n.getBool(e,"autoReveal",!0),this.autoMoveToFoundation=Math.max(0,n.getNumber(e,"autoMoveToFoundation",2)),this.autoCollateKings=n.getBool(e,"autoCollateKings",!0)}toURLSearchParams(){let e=new URLSearchParams;return n.setBool(e,"autoReveal",this.autoReveal,!0),n.setNumber(e,"autoMoveToFoundation",this.autoMoveToFoundation,2),n.setBool(e,"autoCollateKings",this.autoCollateKings,!0),e}}},{"~CardLib/Model/GameOptionsBase":"lqBub","~CardLib/URLSearchParamsEx":"67OEU","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],kYCgP:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GamePresenter",()=>l);var i=e("~CardLib/Debug"),n=e("~CardLib/MathEx"),a=e("~CardLib/Presenter/GamePresenterBase"),o=e("~CardLib/View/Rect");class l extends a.GamePresenterBase{stockPile_;foundationPiles_=[];tableauPiles_=[];get saveDataKey_(){return JSON.stringify({gameName:"klondike",version:0,options:this.game_.options.saveKey})}constructor(e,t){super(e,t);{let t=this.createPileView_(e.stock);t.showFrame=!0,t.fanYUp=3,t.fanYDown=3,this.stockPile_=t}for(let t=0;t<this.game_.foundations.length;++t){let r=this.createPileView_(e.foundations[t]??(0,i.error)());r.showFrame=!0,r.zIndex=800,this.foundationPiles_.push(r)}for(let t=0;t<this.game_.tableaux.length;++t){let r=this.createPileView_(e.tableaux[t]??(0,i.error)());r.showFrame=!0,r.zIndex=800,this.tableauPiles_.push(r)}for(let t of e.cards)this.createCardView_(t);this.layoutPiles_(),this.relayoutAll_()}onResize_(){this.layoutPiles_(),this.relayoutAll_()}layoutPiles_(){let e=this.rootView_.element.clientWidth/this.rootView_.element.clientHeight,t=this.game_.tableaux.length,r=20,s=0,a=1,l=1,d=!0;e<.77?(a=1.5,d=!1):(s+=1,t+=1,e<1.12&&(l=(r=n.lerp(20,17.5,n.inverseLerp(1.12,1,e)))/20));let h=r/1.555555555555,u=e=>(e-.5*(t-1))*(h+1);{let t=this.game_.stock,s=this.getPileView_(t);d?(s.rect=new o.Rect(h,r,u(0),-35*a+1),s.fanXDown=0,s.fanXUp=0,s.fanYDown=3*l,s.fanYUp=3*l):(s.rect=new o.Rect(h,r,u(0),50/e-r),s.fanXDown=3.6*l,s.fanXUp=3.6*l,s.fanYDown=0,s.fanYUp=0)}for(let e=0;e<this.game_.foundations.length;++e){let s=this.game_.foundations[e]??(0,i.error)();this.getPileView_(s).rect=new o.Rect(h,r,u(t-this.game_.foundations.length+e),-35*a+1)}for(let e=0;e<this.game_.tableaux.length;++e){let t=this.game_.tableaux[e]??(0,i.error)(),n=this.getPileView_(t);n.rect=new o.Rect(h,r,u(e+s),-35*a+1+1+r+1),n.fanYDown=3.5*l,n.fanYUp=l*a*3.5}}}},{"~CardLib/Debug":"7pQt2","~CardLib/MathEx":"h275p","~CardLib/Presenter/GamePresenterBase":"aBmck","~CardLib/View/Rect":"aOPAi","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"7J9V3":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);var s=e("./Presenter/GamePresenterFactory");class i{gameId="pyramid";gameName="Pyramid";gamePresenterFactory=new s.GamePresenterFactory}r.default=new i},{"./Presenter/GamePresenterFactory":"3VzvI","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"3VzvI":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GAME_ID",()=>l),s.export(r,"GamePresenterFactory",()=>d);var i=e("~CardLib/View/RootView"),n=e("../Model/Game"),a=e("../Model/GameOptions"),o=e("./GamePresenter");let l="pyramid";class d{createGame(e,t){let r=new a.GameOptions(t),s=new n.Game(r),l=new i.RootView(e);return new o.GamePresenter(s,l)}}},{"~CardLib/View/RootView":"feB3F","../Model/Game":"lSHdb","../Model/GameOptions":"9XDXU","./GamePresenter":"lM0vm","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],lSHdb:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"Game",()=>h);var i=e("~CardLib/Debug"),n=e("~CardLib/Model/DeckUtils"),a=e("~CardLib/Model/DelayHint"),o=e("~CardLib/Model/GameBase"),l=e("~CardLib/Model/Pile"),d=e("~CardLib/Model/Rank");class h extends o.GameBase{options;stock=new l.Pile(this);waste=new l.Pile(this);foundation=new l.Pile(this);pyramid=[];pyramidCoords_=new Map;restocks_=0;constructor(e){super(),this.options=e,this.piles.push(this.stock),this.piles.push(this.waste),this.piles.push(this.foundation);for(let e=0;e<7;++e){let t=[];this.pyramid.push(t);for(let r=0;r<=e;++r){let s=new l.Pile(this);t.push(s),this.pyramidCoords_.set(s,{x:r,y:e}),this.piles.push(s)}}this.cards=n.createStandard52Deck(this.stock)}doGetWon_(){let e=0;for(let t of this.pyramid)for(let r of t)e+=r.length;return 0===e}get wonCards(){let e=[];for(let t of this.foundation)e.push(t);return e.sort((e,t)=>e.pileIndex-t.pileIndex),e}*restart_(e){for(let e of(this.restocks_=0,this.stock))e.faceUp=!1;for(let e=this.piles.length;e-- >0;){let t=this.piles[e]??(0,i.error)();if(t!==this.stock)for(let e=t.length;e-- >0;){let r=t.at(e);r.faceUp=!1,this.stock.push(r)}}for(let t of(this.stock.sort(),this.stock.shuffle(e),yield a.DelayHint.Settle,this.pyramid))for(let e of t){let t=this.stock.peek();t&&(e.push(t),t.faceUp=!0,yield a.DelayHint.Quick)}yield*this.doAutoMoves_()}*cardPrimary_(e){if(e.rank===d.Rank.King&&this.isFree_(e)){this.foundation.push(e),yield*this.doAutoMoves_();return}if(this.stock.peek()===e){e.faceUp?this.waste.push(e):e.faceUp=!0,yield*this.doAutoMoves_();return}}*cardSecondary_(e){}*pilePrimary_(e){if(e===this.stock&&0===this.stock.length&&this.waste.length>0&&this.restocks_<this.options.restocksAllowed){this.restocks_++;for(let e=this.waste.length;e-- >0;)this.waste.at(e).faceUp=!1;yield a.DelayHint.OneByOne;for(let e=this.waste.length;e-- >0;){let t=this.waste.at(e);this.stock.push(t)}yield*this.doAutoMoves_();return}}*pileSecondary_(e){}canDrag_(e){return{canDrag:this.isFree_(e),extraCards:[]}}previewDrop_(e,t){return this.is13Move_(e,t)}*dropCard_(e,t){this.is13Move_(e,t)&&(this.foundation.push(t.peek()??(0,i.error)()),this.foundation.push(e),yield*this.doAutoMoves_())}isFree_(e){if(!e.faceUp)return!1;if(this.stock.peek()===e||this.waste.peek()===e)return!0;let t=this.pyramidCoords_.get(e.pile);if(t){let e=this.pyramid[t.y+1];if(!e)return!0;let r=e[t.x]??(0,i.error)(),s=e[t.x+1]??(0,i.error)();return 0===r.length&&0===s.length}return!1}is13Move_(e,t){if(e.pile===t||!this.isFree_(e))return!1;let r=t.peek();return!!(r&&this.isFree_(r))&&this.getCardValue_(e)+this.getCardValue_(r)===13}getCardValue_(e){switch(e.rank){case d.Rank.Ace:return 1;case d.Rank.Two:return 2;case d.Rank.Three:return 3;case d.Rank.Four:return 4;case d.Rank.Five:return 5;case d.Rank.Six:return 6;case d.Rank.Seven:return 7;case d.Rank.Eight:return 8;case d.Rank.Nine:return 9;case d.Rank.Ten:return 10;case d.Rank.Jack:return 11;case d.Rank.Queen:return 12;case d.Rank.King:return 13;default:return 0}}*doAutoMoves_(){e:for(;;){if(this.options.autoPlayKings){{let e=this.stock.peek();if(e&&this.isFree_(e)&&13===this.getCardValue_(e)){yield a.DelayHint.OneByOne,this.foundation.push(e);continue}}{let e=this.waste.peek();if(e&&this.isFree_(e)&&13===this.getCardValue_(e)){yield a.DelayHint.OneByOne,this.foundation.push(e);continue}}for(let e of this.pyramid)for(let t of e){let e=t.peek();if(e&&this.isFree_(e)&&13===this.getCardValue_(e)){yield a.DelayHint.OneByOne,this.foundation.push(e);continue e}}}if(this.options.autoRevealStockTop){let e=this.stock.peek();if(e&&!e.faceUp){yield a.DelayHint.OneByOne,e.faceUp=!0;continue}}break}}}},{"~CardLib/Debug":"7pQt2","~CardLib/Model/DeckUtils":"kDLU7","~CardLib/Model/DelayHint":"lTDNY","~CardLib/Model/GameBase":"bxQph","~CardLib/Model/Pile":"cKYbt","~CardLib/Model/Rank":"63AzX","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],"9XDXU":[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GameOptions",()=>a);var i=e("~CardLib/Model/GameOptionsBase"),n=e("~CardLib/URLSearchParamsEx");class a extends i.GameOptionsBase{restocksAllowed=2;autoRevealStockTop=!0;autoPlayKings=!0;get saveKey(){return{restocksAllowed:this.restocksAllowed}}constructor(e){super(),this.restocksAllowed=n.getNumber(e,"restocksAllowed",1/0),this.autoRevealStockTop=n.getBool(e,"autoRevealStockTop",!0),this.autoPlayKings=n.getBool(e,"autoPlayKings",!0)}toURLSearchParams(){let e=new URLSearchParams;return n.setNumber(e,"restocksAllowed",this.restocksAllowed,1/0),n.setBool(e,"autoRevealStockTop",this.autoRevealStockTop,!0),n.setBool(e,"autoPlayKings",this.autoPlayKings,!0),e}}},{"~CardLib/Model/GameOptionsBase":"lqBub","~CardLib/URLSearchParamsEx":"67OEU","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}],lM0vm:[function(e,t,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"GamePresenter",()=>o);var i=e("~CardLib/Debug"),n=e("~CardLib/Presenter/GamePresenterBase"),a=e("~CardLib/View/Rect");class o extends n.GamePresenterBase{stockPile_;wastePile_;foundationPile_;pyramidPiles_=[];get saveDataKey_(){return JSON.stringify({gameName:"pyramid",version:0,options:this.game_.options.saveKey})}constructor(e,t){super(e,t);{let t=this.createPileView_(e.stock);t.showFrame=!0,this.stockPile_=t}{let t=this.createPileView_(e.waste);t.showFrame=!0,t.zIndex=50,this.wastePile_=t}{let t=this.createPileView_(e.foundation);t.showFrame=!0,t.zIndex=800,this.foundationPile_=t}for(let t=0;t<e.pyramid.length;++t){let r=e.pyramid[t]??(0,i.error)(),s=[];for(let e of r){let r=this.createPileView_(e);r.zIndex=100*t,s.push(r)}this.pyramidPiles_.push(s)}for(let t of e.cards)this.createCardView_(t);this.layoutPiles_(),this.relayoutAll_()}onResize_(){this.layoutPiles_(),this.relayoutAll_()}layoutPiles_(){let e=this.game_.pyramid.length,t=(e,t)=>(e-.5*(t-1))*14.35714285714745,r=t=>(t-.5*(e-1))*13;this.stockPile_.rect=new a.Rect(12.85714285714745,20,t(0,e),r(0)),this.wastePile_.rect=new a.Rect(12.85714285714745,20,t(1,e),r(0)),this.foundationPile_.rect=new a.Rect(12.85714285714745,20,t(e-1,e),r(0));for(let s=0;s<e;++s){let e=this.game_.pyramid[s]??(0,i.error)();for(let n=0;n<e.length;++n)((this.pyramidPiles_[s]??(0,i.error)())[n]??(0,i.error)()).rect=new a.Rect(12.85714285714745,20,t(n,e.length),r(s))}}}},{"~CardLib/Debug":"7pQt2","~CardLib/Presenter/GamePresenterBase":"aBmck","~CardLib/View/Rect":"aOPAi","@parcel/transformer-js/src/esmodule-helpers.js":"lOn3Z"}]},["diwG0"],"diwG0","parcelRequire3ac0");