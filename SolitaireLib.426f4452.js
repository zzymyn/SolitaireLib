parcelRequire=function(e){var r="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,i={};function u(e,u){if(e in i)return i[e];var t="function"==typeof parcelRequire&&parcelRequire;if(!u&&t)return t(e,!0);if(r)return r(e,!0);if(n&&"string"==typeof e)return n(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return u.register=function(e,r){i[e]=r},i=e(u),u.modules=i,u}(function (require) {var q=function(){function r(){}return r.assert=function(e,o){e||r.error(o)},r.error=function(r){throw r=r||"Assert failed",new Error(r)},r}();var ma={};var X=ma&&ma.__values||function(e){var o="function"==typeof Symbol&&Symbol.iterator,t=o&&e[o],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")},N=function(){function e(e){var o=this;this.touchResponders_=[],this.pxPerRem_=0,this.onResize_=function(){o.refreshUnits_()},this.onWindowMouseMove_=function(e){var t,r,n,i;if(1!==e.buttons)try{for(var a=X(o.touchResponders_),s=a.next();!s.done;s=a.next()){s.value.onTouchUp(-1,!0,e.timeStamp)}}catch(c){t={error:c}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else try{for(var u=X(o.touchResponders_),h=u.next();!h.done;h=u.next()){h.value.onTouchMoved(-1,e.pageX,e.pageY,e.timeStamp)}}catch(d){n={error:d}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}},this.onWindowMouseUp_=function(e){var t,r;if(0===e.button)try{for(var n=X(o.touchResponders_),i=n.next();!i.done;i=n.next()){i.value.onTouchUp(-1,!1,e.timeStamp)}}catch(a){t={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},this.onWindowTouchMove_=function(e){for(var t,r,n=0;n<e.changedTouches.length;++n){var i=e.changedTouches.item(n);if(i)try{for(var a=(t=void 0,X(o.touchResponders_)),s=a.next();!s.done;s=a.next()){s.value.onTouchMoved(i.identifier,i.pageX,i.pageY,e.timeStamp)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}},this.onWindowTouchEnd_=function(e){for(var t,r,n=0;n<e.changedTouches.length;++n){var i=e.changedTouches.item(n);if(i)try{for(var a=(t=void 0,X(o.touchResponders_)),s=a.next();!s.done;s=a.next()){s.value.onTouchUp(i.identifier,!1,e.timeStamp)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}},this.onWindowTouchCancel_=function(e){for(var t,r,n=0;n<e.changedTouches.length;++n){var i=e.changedTouches.item(n);if(i)try{for(var a=(t=void 0,X(o.touchResponders_)),s=a.next();!s.done;s=a.next()){s.value.onTouchUp(i.identifier,!0,e.timeStamp)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}},this.element_=e,window.addEventListener("resize",this.onResize_),window.addEventListener("mousemove",this.onWindowMouseMove_),window.addEventListener("mouseup",this.onWindowMouseUp_),window.addEventListener("touchmove",this.onWindowTouchMove_),window.addEventListener("touchend",this.onWindowTouchEnd_),window.addEventListener("touchcancel",this.onWindowTouchCancel_),this.refreshUnits_()}return Object.defineProperty(e.prototype,"pxPerRem",{get:function(){return this.pxPerRem_},enumerable:!0,configurable:!0}),e.prototype.refreshUnits_=function(){var e=getComputedStyle(this.element_);this.pxPerRem_=1/parseFloat(e.fontSize)},e.prototype.addTouchResponder=function(e){var o=this.touchResponders_.indexOf(e);q.assert(o<0),this.touchResponders_.push(e)},e.prototype.removeTouchResponder=function(e){var o=this.touchResponders_.indexOf(e);q.assert(o>=0),this.touchResponders_.splice(o,1)},e.TOUCH_DEADZONE=5,e.TOUCH_DEADZONE_SQ=25,e}();ma.ViewContext=N;var na=function(){function e(){}return e.instantiateTemplate=function(e,t){var r=document.getElementById(t);r instanceof HTMLTemplateElement||q.error();var n=r.content.firstElementChild;n instanceof HTMLElement||q.error();var i=document.importNode(n,!0);return i instanceof HTMLElement||q.error(),e.appendChild(i)},e}();var za=function(){function t(t){this.context=new N(t),this.element=na.instantiateTemplate(t,"rootViewTemplate")}return t.prototype.dispose=function(){this.element.remove()},t}();var Q={};var ba={};var Ua,ca;(function($){$[$.None=0]="None",$[$.Black=1]="Black",$[$.Red=2]="Red"})(ca||(Ua=ca={},Ua));var Va,j;(function(e){e[e.None=0]="None",e[e.Ace=1]="Ace",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five",e[e.Six=6]="Six",e[e.Seven=7]="Seven",e[e.Eight=8]="Eight",e[e.Nine=9]="Nine",e[e.Ten=10]="Ten",e[e.Eleven=11]="Eleven",e[e.Twelve=12]="Twelve",e[e.Thirteen=13]="Thirteen",e[e.Jack=100]="Jack",e[e.Queen=101]="Queen",e[e.King=102]="King"})(j||(Va=j={},Va));var Wa,da;(function($){$[$.None=0]="None",$[$.Spades=1]="Spades",$[$.Hearts=2]="Hearts",$[$.Diamonds=3]="Diamonds",$[$.Clubs=4]="Clubs"})(da||(Wa=da={},Wa));var Aa=ba&&ba.__values||function(t){var r="function"==typeof Symbol&&Symbol.iterator,$=r&&t[r],e=0;if($)return $.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Xa=ba&&ba.__read||function(t,r){var $="function"==typeof Symbol&&t[Symbol.iterator];if(!$)return t;var e,o,a=$.call(t),n=[];try{for(;(void 0===r||r-->0)&&!(e=a.next()).done;)n.push(e.value)}catch(i){o={error:i}}finally{try{e&&!e.done&&($=a.return)&&$.call(a)}finally{if(o)throw o.error}}return n},Ya=[[da.Spades,ca.Black],[da.Hearts,ca.Red],[da.Diamonds,ca.Red],[da.Clubs,ca.Black]],Za=[j.Ace,j.Two,j.Three,j.Four,j.Five,j.Six,j.Seven,j.Eight,j.Nine,j.Ten,j.Jack,j.Queen,j.King],oa=function(){function t(){}return t.createStandard52Deck=function(t){var r,$,e,o,a=[];try{for(var n=Aa(Ya),i=n.next();!i.done;i=n.next()){var l=Xa(i.value,2),C=l[0],u=l[1];try{for(var T=(e=void 0,Aa(Za)),I=T.next();!I.done;I=T.next()){var p=I.value,c=t.createCard(C,u,p);a.push(c)}}catch(v){e={error:v}}finally{try{I&&!I.done&&(o=T.return)&&o.call(T)}finally{if(e)throw e.error}}}}catch(s){r={error:s}}finally{try{i&&!i.done&&($=n.return)&&$.call(n)}finally{if(r)throw r.error}}return a},t}();ba.DeckUtils=oa;var $a,z;(function(e){e[e.None=0]="None",e[e.Quick=1]="Quick",e[e.OneByOne=2]="OneByOne",e[e.Settle=3]="Settle"})(z||($a=z={},$a));var ea={};var _a=214013,ab=2531011,bb=4294967295,cb=(1<<31)-1,ka=function(e){return e*_a+ab&bb},la=function(e){return(e&cb)>>16},a=function(){function e(e){this.seed=e}return e.prototype.min=function(){return e.min},e.prototype.max=function(){return e.max},e.prototype.next=function(){var $=ka(this.seed);return[la($),new e($)]},e.min=0,e.max=Math.pow(2,15)-1,e}(),b=function(){function e(e){this.seed=e}return e.prototype.min=function(){return e.min},e.prototype.max=function(){return e.max},e.prototype.next=function(){var $=ka(this.seed),r=la($),t=ka($),n=la(t),o=ka(t);return[2147483648+(la(o)+(n+(r<<15)<<15)+2147483648|0),new e(o)]},e.min=0,e.max=4294967295,e}();function db(t){return(0|t)>=0?0|t:4294967296+(0|t)}function eb(t,r){var n=65535&t,e=65535&r;return n*e+(n*(r>>>16&65535)+(t>>>16&65535)*e<<16)}var fb=function(){function t(r,n){n>=t.N?(this.states=t.twist(r),this.index=0):(this.states=r,this.index=n)}return t.twist=function(r){for(var n=r.slice(),e=0;e!==t.N-t.M;++e){var i=(n[e]&t.MASK_UPPER)+(n[e+1]&t.MASK_LOWER);n[e]=n[e+t.M]^i>>>1^-(1&i)&t.A}for(e=t.N-t.M;e!==t.N-1;++e){var s=(n[e]&t.MASK_UPPER)+(n[e+1]&t.MASK_LOWER);n[e]=n[e+t.M-t.N]^s>>>1^-(1&s)&t.A}var o=(n[t.N-1]&t.MASK_UPPER)+(n[0]&t.MASK_LOWER);return n[t.N-1]=n[t.M-1]^o>>>1^-(1&o)&t.A,n},t.seeded=function(r){var n=Array(t.N);n[0]=r;for(var e=1;e!==t.N;++e){var i=n[e-1]^n[e-1]>>>30;n[e]=eb(t.F,i)+e|0}return n},t.from=function(r){return new t(t.seeded(r),t.N)},t.prototype.min=function(){return t.min},t.prototype.max=function(){return t.max},t.prototype.next=function(){var r=this.states[this.index];return r^=this.states[this.index]>>>t.U,r^=r<<t.S&t.B,r^=r<<t.T&t.C,[db(r^=r>>>t.L),new t(this.states,this.index+1)]},t.min=0,t.max=4294967295,t.N=624,t.M=397,t.R=31,t.A=2567483615,t.F=1812433253,t.U=11,t.S=7,t.B=2636928640,t.T=15,t.C=4022730752,t.L=18,t.MASK_LOWER=Math.pow(2,t.R)-1,t.MASK_UPPER=Math.pow(2,t.R),t}(),gb=function(t){return fb.from(t)};var c=function(){function s(s,t,r,i){this.s01=s,this.s00=t,this.s11=r,this.s10=i}return s.prototype.min=function(){return-2147483648},s.prototype.max=function(){return 2147483647},s.prototype.next=function(){var t=this.s00^this.s00<<23,r=this.s01^(this.s01<<23|this.s00>>>9),i=t^this.s10^(t>>>18|r<<14)^(this.s10>>>5|this.s11<<27),n=r^this.s11^r>>>18^this.s11>>>5;return[this.s00+this.s10|0,new s(this.s11,this.s10,n,i)]},s.prototype.jump=function(){for(var t=this,r=0,i=0,n=0,o=0,h=[1667051007,2321340297,1548169110,304075285],e=0;4!==e;++e)for(var u=1;u;u<<=1)h[e]&u&&(r^=t.s01,i^=t.s00,n^=t.s11,o^=t.s10),t=t.next()[1];return new s(r,i,n,o)},s}();var d=function(){function s(s,t,r,o){this.s01=s,this.s00=t,this.s11=r,this.s10=o}return s.prototype.min=function(){return-2147483648},s.prototype.max=function(){return 2147483647},s.prototype.next=function(){var t=this.s10^this.s00,r=this.s11^this.s01,o=this.s00<<24^this.s01>>>8^t^t<<16,i=this.s01<<24^this.s00>>>8^r^(r<<16|t>>>16),n=r<<5^t>>>27,h=t<<5^r>>>27;return[this.s00+this.s10|0,new s(i,o,h,n)]},s.prototype.jump=function(){for(var t=this,r=0,o=0,i=0,n=0,h=[3639956645,3750757012,1261568508,386426335],e=0;4!==e;++e)for(var u=1;u;u<<=1)h[e]&u&&(r^=t.s01,o^=t.s00,i^=t.s11,n^=t.s10),t=t.next()[1];return new s(r,o,i,n)},s}();function Ba(r,n,t){var a=t.min(),o=t.max()-t.min()+1;if(n<=o)for(var i=t,$=o-o%n;;){var f=(l=i.next())[0]-a;if(i=l[1],f<$)return[f%n+r,i]}for(var u=1,e=0;u<n;)u*=o,++e;for(var v=n*Math.floor(1*u/n),m=t;;){for(var I=0,g=0;g!==e;++g){var l;I=o*I+((l=m.next())[0]-a),m=l[1]}if(I<v)return[I-n*Math.floor(1*I/n)+r,m]}}function hb(r,n,t){var a=n-r+1;return null!=t?Ba(r,a,t):function(n){return Ba(r,a,n)}}var Ca=function(){function e(e,r,t){this.card_=e,this.oldFaceUp_=r,this.newFaceUp_=t}return e.prototype.undo=function(){this.card_.doSetFaceUp(this.oldFaceUp_)},e.prototype.redo=function(){this.card_.doSetFaceUp(this.newFaceUp_)},e.prototype.serialize=function(e){e.writeCard(this.card_),e.writeBool(this.oldFaceUp_),e.writeBool(this.newFaceUp_)},Object.defineProperty(e.prototype,"deserializer",{get:function(){return e.deserialize},enumerable:!0,configurable:!0}),e.deserialize=function(r){return new e(r.readCard(),r.readBool(),r.readBool())},e}();var Y=function(){function e(e,i,t,n,p,s){this.pileIndex=0,this.pileChanged=function(){},this.pileIndexChanged=function(){},this.faceUpChanged=function(){},this.faceUp_=!1,this.game=e,this.suit=i,this.colour=t,this.rank=n,this.pile=p,this.pileIndex=s}return Object.defineProperty(e.prototype,"faceUp",{get:function(){return this.faceUp_},set:function(e){if(this.faceUp_!==e){var i=this.faceUp_,t=new Ca(this,i,e);this.game.addUndoableOperation(t),t.redo()}},enumerable:!0,configurable:!0}),e.prototype.doSetFaceUp=function(e){this.faceUp_=e,this.faceUpChanged()},e.prototype.onPileChanged=function(e,i){this.pile===e?this.onPileIndexChanged(i):(this.pile=e,this.pileIndex=i,this.pile?q.assert(this.pileIndex===this.pile.indexOf(this)):q.assert(0===this.pileIndex),this.pileChanged())},e.prototype.onPileIndexChanged=function(e){this.pileIndex!==e&&(this.pileIndex=e,this.pile?q.assert(this.pileIndex===this.pile.indexOf(this)):q.assert(0===this.pileIndex),this.pileIndexChanged())},e.prototype.serializeState=function(e){e.write(this.faceUp?1:0)},e.prototype.deserializeState=function(e){this.faceUp=0!==e.readRange(0,1)},e}();var pa={};var Da=function(){function r(){}return r.ensureNumber=function(r){if("number"!=typeof r)throw new Error("Value was not a number.");return r},r.ensureString=function(r){if("string"!=typeof r)throw new Error("Value was not a string.");return r},r.ensureBoolean=function(r){if("boolean"!=typeof r)throw new Error("Value was not a boolean.");return r},r.ensureArray=function(r){if(!(r instanceof Array))throw new Error("Value was not an array.");return r},r}();var qa=function(){function t(){this.nextId_=0,this.idToItem_=new Map,this.itemToId_=new Map}return t.prototype.add=function(t){var e=this.nextId_++;this.idToItem_.set(e,t),this.itemToId_.set(t,e)},t.prototype.get=function(t){var e=this.idToItem_.get(t);if(!e)throw new Error("Item with id "+t+" not found.");return e},t.prototype.getId=function(t){var e=this.itemToId_.get(t);if("number"!=typeof e)throw new Error("Failed to find id for item.");return e},t}();var ib=pa&&pa.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ea=function(){function t(){this.data_=[],this.dataIndex_=0,this.cardMap_=new qa,this.pileMap_=new qa,this.undoableDeserializerMap_=new qa}return t.prototype.write=function(t){this.dataIndex_=this.data_.push(t)},t.prototype.writeBool=function(t){return this.write(t?1:0)},t.prototype.writeCard=function(t){this.write(this.getCardId(t))},t.prototype.writePile=function(t){this.write(this.getPileId(t))},t.prototype.writeUndoable=function(t){this.writeUndoableDeserializer_(t.deserializer),t.serialize(this)},t.prototype.writeUndoableDeserializer_=function(t){this.write(this.getUndoableDeserializerId(t))},t.prototype.read=function(){return this.data_[this.dataIndex_++]},t.prototype.readRange=function(t,e){var r=this.read();if(r>=t&&r<=e)return r;throw new Error("Value "+r+" not in range ["+t+", "+e+"].")},t.prototype.readBool=function(){return 0!==this.readRange(0,1)},t.prototype.readCard=function(){return this.getCard(this.read())},t.prototype.readPile=function(){return this.getPile(this.read())},t.prototype.readUndoable=function(){return this.readUndoableDeserializer_()(this)},t.prototype.readUndoableDeserializer_=function(){return this.getUndoableDeserializer(this.read())},t.prototype.toJson=function(){return JSON.stringify(this.data_)},t.prototype.fromJson=function(t){var e,r,i=JSON.parse(t);Da.ensureArray(i);try{for(var o=ib(i),n=o.next();!n.done;n=o.next()){var a=n.value;Da.ensureNumber(a)}}catch(d){e={error:d}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}this.data_=i,this.dataIndex_=0},t.prototype.ensureAtEnd=function(){if(this.dataIndex_!==this.data_.length)throw new Error("Deserialization did not consume all data.")},t.prototype.addCard=function(t){return this.cardMap_.add(t)},t.prototype.getCard=function(t){return this.cardMap_.get(t)},t.prototype.getCardId=function(t){return this.cardMap_.getId(t)},t.prototype.addPile=function(t){return this.pileMap_.add(t)},t.prototype.getPile=function(t){return this.pileMap_.get(t)},t.prototype.getPileId=function(t){return this.pileMap_.getId(t)},t.prototype.addUndoableDeserializer=function(t){return this.undoableDeserializerMap_.add(t)},t.prototype.getUndoableDeserializer=function(t){return this.undoableDeserializerMap_.get(t)},t.prototype.getUndoableDeserializerId=function(t){return this.undoableDeserializerMap_.getId(t)},t}();pa.GameSerializationContext=Ea;var R={};var Fa=function(){function e(e,i,t,r,n){this.card_=e,this.oldPile_=i,this.oldPileIndex_=t,this.newPile_=r,this.newPileIndex_=n}return e.prototype.undo=function(){this.oldPile_.doInsert(this.oldPileIndex_,this.card_)},e.prototype.redo=function(){this.newPile_.doInsert(this.newPileIndex_,this.card_)},e.prototype.serialize=function(e){e.writeCard(this.card_),e.writePile(this.oldPile_),e.write(this.oldPileIndex_),e.writePile(this.newPile_),e.write(this.newPileIndex_)},Object.defineProperty(e.prototype,"deserializer",{get:function(){return e.deserialize},enumerable:!0,configurable:!0}),e.deserialize=function(i){return new e(i.readCard(),i.readPile(),i.read(),i.readPile(),i.read())},e}();var Ga=function(){function e(e,t,i){this.pile_=e,this.oldMaxFan_=t,this.newMaxFan_=i}return e.prototype.undo=function(){this.pile_.doSetMaxFan(this.oldMaxFan_)},e.prototype.redo=function(){this.pile_.doSetMaxFan(this.newMaxFan_)},e.prototype.serialize=function(e){e.writePile(this.pile_),e.write(this.oldMaxFan_),e.write(this.newMaxFan_)},Object.defineProperty(e.prototype,"deserializer",{get:function(){return e.deserialize},enumerable:!0,configurable:!0}),e.deserialize=function(t){return new e(t.readPile(),t.read(),t.read())},e}();var jb=R&&R.__generator||function(r,e){var t,n,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue;}i=e.call(r,o)}catch(s){i=[6,s],n=0}finally{t=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Ha=R&&R.__values||function(r){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},kb=R&&R.__read||function(r,e){var t="function"==typeof Symbol&&r[Symbol.iterator];if(!t)return r;var n,a,i=t.call(r),o=[];try{for(;(void 0===e||e-->0)&&!(n=i.next()).done;)o.push(n.value)}catch(s){a={error:s}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}return o},D=function(){function r(r){this.cardsChanged=function(){},this.maxFanChanged=function(){},this.cards_=[],this.maxFan_=999,this.game=r}return Object.defineProperty(r.prototype,"length",{get:function(){return this.cards_.length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxFan",{get:function(){return this.maxFan_},set:function(r){if(r=Math.max(0,r),this.maxFan_!==r){var e=this.maxFan_,t=new Ga(this,e,r);this.game.addUndoableOperation(t),t.redo()}},enumerable:!0,configurable:!0}),r.prototype.doSetMaxFan=function(r){this.maxFan_=r,this.maxFanChanged()},r.prototype[Symbol.iterator]=function(){var r,e,t,n,a;return jb(this,function(i){switch(i.label){case 0:i.trys.push([0,5,6,7]),r=Ha(this.cards_),e=r.next(),i.label=1;case 1:return e.done?[3,4]:[4,e.value];case 2:i.sent(),i.label=3;case 3:return e=r.next(),[3,1];case 4:return[3,7];case 5:return t=i.sent(),n={error:t},[3,7];case 6:try{e&&!e.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}return[7];case 7:return[2];}})},r.prototype.createCard=function(r,e,t){var n=new Y(this.game,r,e,t,this,this.length);return this.cards_.push(n),this.cardsChanged(),n},r.prototype.at=function(r){q.assert(r>=0&&r<this.cards_.length);var e=this.cards_[r];return q.assert(e.pile===this),e},r.prototype.slice=function(r,e){return this.cards_.slice(r,e)},r.prototype.indexOf=function(r){return this.cards_.indexOf(r)},r.prototype.sort=function(){this.cards_.sort(function(r,e){return r.suit<e.suit?-1:r.suit>e.suit?1:r.colour<e.colour?-1:r.colour>e.colour?1:r.rank<e.rank?-1:r.rank>e.rank?1:0});for(var r=0;r<this.cards_.length;++r)this.cards_[r].onPileIndexChanged(r);this.cardsChanged()},r.prototype.shuffle=function(r){for(var e,t=0;t<this.cards_.length;++t){var n;n=(e=kb(hb(t,this.cards_.length-1,r),2))[0],r=e[1];var a=this.cards_[t];this.cards_[t]=this.cards_[n],this.cards_[n]=a}for(t=0;t<this.cards_.length;++t)this.cards_[t].onPileIndexChanged(t);this.cardsChanged()},r.prototype.push=function(r){return this.insert(this.cards_.length,r)},r.prototype.peek=function(){if(!(this.cards_.length<=0))return this.at(this.cards_.length-1)},r.prototype.insert=function(r,e){var t=e.pile,n=e.pileIndex,a=new Fa(e,t,n,this,r);this.game.addUndoableOperation(a),a.redo()},r.prototype.doInsert=function(r,e){q.assert(r>=0&&r<=this.cards_.length),e.pile===this&&r>e.pileIndex&&r--,e.pile.remove_(e),this.cards_.splice(r,0,e),e.onPileChanged(this,r);for(var t=r+1;t<this.cards_.length;++t)this.cards_[t].onPileIndexChanged(t);return this.cardsChanged(),e},r.prototype.remove_=function(r){q.assert(r.pile===this);var e=r.pileIndex;q.assert(this.at(e)===r),this.cards_.splice(e,1);for(var t=e;t<this.cards_.length;++t)this.cards_[t].onPileIndexChanged(t);return this.cardsChanged(),r},r.prototype.serializeState=function(r){var e,t;r.write(this.maxFan),r.write(this.cards_.length);try{for(var n=Ha(this.cards_),a=n.next();!a.done;a=n.next()){var i=a.value;r.write(r.getCardId(i))}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.deserializeState=function(r){this.maxFan=r.readRange(0,999);for(var e=r.readRange(0,999),t=0;t<e;++t){var n=r.getCard(r.read());this.insert(t,n)}},r}();R.Pile=D;var ra={},Ia=ra&&ra.__values||function(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},sa=function(){function e(){this.ops_=[]}return Object.defineProperty(e.prototype,"length",{get:function(){return this.ops_.length},enumerable:!0,configurable:!0}),e.prototype.addOperation=function(e){this.ops_.push(e)},e.prototype.undo=function(){for(var e=this.ops_.length;e-->0;)this.ops_[e].undo()},e.prototype.redo=function(){var e,r;try{for(var t=Ia(this.ops_),o=t.next();!o.done;o=t.next()){o.value.redo()}}catch(n){e={error:n}}finally{try{o&&!o.done&&(r=t.return)&&r.call(t)}finally{if(e)throw e.error}}},e.prototype.serialize=function(e){var r,t;e.write(this.ops_.length);try{for(var o=Ia(this.ops_),n=o.next();!n.done;n=o.next()){var i=n.value;e.writeUndoable(i)}}catch(a){r={error:a}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(r)throw r.error}}},Object.defineProperty(e.prototype,"deserializer",{get:function(){return e.deserialize},enumerable:!0,configurable:!0}),e.deserialize=function(r){for(var t=new e,o=r.read(),n=0;n<o;++n)t.addOperation(r.readUndoable());return t},e}();ra.CompoundUndoableOperation=sa;var P=ea&&ea.__generator||function(r,e){var t,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue;}i=e.call(r,o)}catch(s){i=[6,s],a=0}finally{t=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},E=ea&&ea.__values||function(r){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&r[e],a=0;if(t)return t.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&a>=r.length&&(r=void 0),{value:r&&r[a++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ja=2,ta=function(){function r(){this.cards=[],this.piles=[],this.undoStack_=[],this.redoStack_=[],this.currentOperation_=void 0}return r.prototype.restart=function(r){var e;return P(this,function(t){switch(t.label){case 0:return this.startOperation_()?(e=gb(r),[5,E(this.restart_(e))]):[3,2];case 1:t.sent(),this.commitOperation_(),this.undoStack_=[],this.redoStack_=[],t.label=2;case 2:return[2];}})},Object.defineProperty(r.prototype,"canUndo",{get:function(){return this.undoStack_.length>0},enumerable:!0,configurable:!0}),r.prototype.undo=function(){var r;return P(this,function(e){return(r=this.undoStack_.pop())&&(r.undo(),this.redoStack_.push(r)),[2]})},Object.defineProperty(r.prototype,"canRedo",{get:function(){return this.redoStack_.length>0},enumerable:!0,configurable:!0}),r.prototype.redo=function(){var r;return P(this,function(e){return(r=this.redoStack_.pop())&&(r.redo(),this.undoStack_.push(r)),[2]})},r.prototype.getHint=function(){throw new Error("Method not implemented.")},r.prototype.pilePrimary=function(r){return P(this,function(e){switch(e.label){case 0:return this.startOperation_()?(r instanceof D||q.error(),q.assert(this.piles.indexOf(r)>=0),[5,E(this.pilePrimary_(r))]):[3,2];case 1:e.sent(),this.commitOperation_(),e.label=2;case 2:return[2];}})},r.prototype.pileSecondary=function(r){return P(this,function(e){switch(e.label){case 0:return this.startOperation_()?(r instanceof D||q.error(),q.assert(this.piles.indexOf(r)>=0),[5,E(this.pileSecondary_(r))]):[3,2];case 1:e.sent(),this.commitOperation_(),e.label=2;case 2:return[2];}})},r.prototype.cardPrimary=function(r){return P(this,function(e){switch(e.label){case 0:return this.startOperation_()?(r instanceof Y||q.error(),q.assert(this.cards.indexOf(r)>=0),[5,E(this.cardPrimary_(r))]):[3,2];case 1:e.sent(),this.commitOperation_(),e.label=2;case 2:return[2];}})},r.prototype.cardSecondary=function(r){return P(this,function(e){switch(e.label){case 0:return this.startOperation_()?(r instanceof Y||q.error(),q.assert(this.cards.indexOf(r)>=0),[5,E(this.cardSecondary_(r))]):[3,2];case 1:e.sent(),this.commitOperation_(),e.label=2;case 2:return[2];}})},r.prototype.canDrag=function(r){return r instanceof Y||q.error(),q.assert(this.cards.indexOf(r)>=0),this.canDrag_(r)},r.prototype.previewDrop=function(r,e){return r instanceof Y||q.error(),e instanceof D||q.error(),q.assert(this.cards.indexOf(r)>=0),q.assert(this.piles.indexOf(e)>=0),this.previewDrop_(r,e)},r.prototype.dropCard=function(r,e){return P(this,function(t){switch(t.label){case 0:return this.startOperation_()?(r instanceof Y||q.error(),e instanceof D||q.error(),q.assert(this.cards.indexOf(r)>=0),q.assert(this.piles.indexOf(e)>=0),[5,E(this.dropCard_(r,e))]):[3,2];case 1:t.sent(),this.commitOperation_(),t.label=2;case 2:return[2];}})},r.prototype.startOperation_=function(){return!this.currentOperation_&&(this.currentOperation_=new sa,!0)},r.prototype.addUndoableOperation=function(r){this.currentOperation_&&this.currentOperation_.addOperation(r)},r.prototype.commitOperation_=function(){this.currentOperation_||q.error(),this.currentOperation_.length>0&&(this.undoStack_.push(this.currentOperation_),this.redoStack_=[]),this.currentOperation_=void 0},r.prototype.serialize=function(){var r,e,t,a,n=this.createSerializationContext_();n.write(Ja);try{for(var i=E(this.cards),o=i.next();!o.done;o=i.next()){o.value.serializeState(n)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(r)throw r.error}}try{for(var s=E(this.piles),$=s.next();!$.done;$=s.next()){$.value.serializeState(n)}}catch(c){t={error:c}}finally{try{$&&!$.done&&(a=s.return)&&a.call(s)}finally{if(t)throw t.error}}return this.serializeUndoStack_(n,this.undoStack_),this.serializeUndoStack_(n,this.redoStack_),n.toJson()},r.prototype.serializeUndoStack_=function(r,e){var t,a;r.write(e.length);try{for(var n=E(e),i=n.next();!i.done;i=n.next()){var o=i.value;r.writeUndoable(o)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(a=n.return)&&a.call(n)}finally{if(t)throw t.error}}},r.prototype.deserialize=function(r){var e,t,a,n;try{var i=this.createSerializationContext_();if(i.fromJson(r),i.read()!==Ja)throw new Error("Unknown save data format.");try{for(var o=E(this.cards),s=o.next();!s.done;s=o.next()){s.value.deserializeState(i)}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}try{for(var $=E(this.piles),l=$.next();!l.done;l=$.next()){l.value.deserializeState(i)}}catch(u){a={error:u}}finally{try{l&&!l.done&&(n=$.return)&&n.call($)}finally{if(a)throw a.error}}return this.undoStack_=this.deserializeUndoStack_(i),this.redoStack_=this.deserializeUndoStack_(i),i.ensureAtEnd(),!0}catch(p){return console.error("Failed to deserialize game state.",p),!1}},r.prototype.deserializeUndoStack_=function(r){for(var e=[],t=r.read(),a=0;a<t;++a)e.push(r.readUndoable());return e},r.prototype.createSerializationContext_=function(){var r,e,t,a,n=new Ea;try{for(var i=E(this.cards),o=i.next();!o.done;o=i.next()){var s=o.value;n.addCard(s)}}catch(u){r={error:u}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(r)throw r.error}}try{for(var $=E(this.piles),l=$.next();!l.done;l=$.next()){var c=l.value;n.addPile(c)}}catch(p){t={error:p}}finally{try{l&&!l.done&&(a=$.return)&&a.call($)}finally{if(t)throw t.error}}return n.addUndoableDeserializer(sa.deserialize),n.addUndoableDeserializer(Ca.deserialize),n.addUndoableDeserializer(Fa.deserialize),n.addUndoableDeserializer(Ga.deserialize),n},r}();ea.GameBase=ta;var lb=Q&&Q.__extends||function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),G=Q&&Q.__generator||function(e,r){var t,n,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue;}o=r.call(e,s)}catch(i){o=[6,i],n=0}finally{t=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},A=Q&&Q.__values||function(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},mb=7,Ka=function(e){function r(r){var t=e.call(this)||this;t.stock=new D(t),t.waste=new D(t),t.foundations=[],t.tableaux=[],t.dragSingleSources_=[],t.autoMoveSources_=[],t.restocks_=0,t.options=r,t.piles.push(t.stock),t.piles.push(t.waste),t.dragSingleSources_.push(t.waste),t.autoMoveSources_.push(t.waste);for(var n=0;n<4;++n){var a=new D(t);t.foundations.push(a),t.dragSingleSources_.push(a),t.piles.push(a)}for(n=0;n<mb;++n){a=new D(t);t.tableaux.push(a),t.dragSingleSources_.push(a),t.autoMoveSources_.push(a),t.piles.push(a)}return t.cards=oa.createStandard52Deck(t.stock),t}return lb(r,e),r.prototype.restart_=function(e){var r,t,n,a,o,s,i,u,c,l;return G(this,function($){switch($.label){case 0:this.restocks_=0;try{for(r=A(this.stock),t=r.next();!t.done;t=r.next())(u=t.value).faceUp=!1}catch(p){c={error:p}}finally{try{t&&!t.done&&(l=r.return)&&l.call(r)}finally{if(c)throw c.error}}for(n=this.piles.length;n-->0;)if((s=this.piles[n])!==this.stock)for(a=s.length;a-->0;)(u=s.at(a)).faceUp=!1,this.stock.push(u);return this.stock.sort(),this.stock.shuffle(e),[4,z.Settle];case 1:$.sent(),o=0,$.label=2;case 2:if(!(o<this.tableaux.length))return[3,7];s=this.tableaux[o],i=0,$.label=3;case 3:return i<=o?(u=this.stock.peek())?(s.push(u),[4,z.Quick]):[3,5]:[3,6];case 4:$.sent(),$.label=5;case 5:return++i,[3,3];case 6:return++o,[3,2];case 7:return[4,z.OneByOne];case 8:return $.sent(),[5,A(this.doAutoMoves_())];case 9:return $.sent(),[2];}})},r.prototype.cardPrimary_=function(e){return G(this,function(r){switch(r.label){case 0:return this.stock.peek()===e&&this.canDrawFromStock_()?[5,A(this.doDrawFromStock_())]:[3,3];case 1:return r.sent(),[5,A(this.doAutoMoves_())];case 2:return r.sent(),[2];case 3:return this.tableaux.indexOf(e.pile)?e.pile.peek()!==e||e.faceUp?[3,6]:(e.faceUp=!0,[4,z.OneByOne]):[3,6];case 4:return r.sent(),[5,A(this.doAutoMoves_())];case 5:return r.sent(),[2];case 6:return[2];}})},r.prototype.cardSecondary_=function(e){var r,t,n,a,o,s;return G(this,function(i){switch(i.label){case 0:if(!(this.autoMoveSources_.indexOf(e.pile)>=0))return[3,9];i.label=1;case 1:i.trys.push([1,7,8,9]),r=A(this.foundations),t=r.next(),i.label=2;case 2:return t.done?[3,6]:(n=t.value,this.isFoundationDrop_(e,n)?(n.push(e),[4,z.OneByOne]):[3,5]);case 3:return i.sent(),[5,A(this.doAutoMoves_())];case 4:return i.sent(),[2];case 5:return t=r.next(),[3,2];case 6:return[3,9];case 7:return a=i.sent(),o={error:a},[3,9];case 8:try{t&&!t.done&&(s=r.return)&&s.call(r)}finally{if(o)throw o.error}return[7];case 9:return[2];}})},r.prototype.pilePrimary_=function(e){var r,t;return G(this,function(n){switch(n.label){case 0:if(!(e===this.stock&&0===this.stock.length&&this.waste.length>0&&this.restocks_<this.options.restocksAllowed))return[3,4];for(this.restocks_++,r=this.waste.length;r-->0;)(t=this.waste.at(r)).faceUp=!1;return this.waste.maxFan=0,[4,z.OneByOne];case 1:for(n.sent(),r=this.waste.length;r-->0;)t=this.waste.at(r),this.stock.push(t);return[4,z.OneByOne];case 2:return n.sent(),[5,A(this.doAutoMoves_())];case 3:return n.sent(),[2];case 4:return[2];}})},r.prototype.pileSecondary_=function(e){return G(this,function(e){return[2]})},r.prototype.canDrag_=function(e){return this.isFoundationDropSource_(e)?{canDrag:!0,extraCards:[]}:this.isTableauxDropSource_(e)?{canDrag:!0,extraCards:e.pile.slice(e.pileIndex+1)}:{canDrag:!1,extraCards:[]}},r.prototype.previewDrop_=function(e,r){return this.isTableauxDrop_(e,r)||this.isFoundationDrop_(e,r)},r.prototype.dropCard_=function(e,r){return G(this,function(t){switch(t.label){case 0:return this.isTableauxDrop_(e,r)?[5,A(this.doTableauxDrop_(e,r))]:[3,3];case 1:return t.sent(),[5,A(this.doAutoMoves_())];case 2:return t.sent(),[3,6];case 3:return this.isFoundationDrop_(e,r)?[5,A(this.doFoundationDrop_(e,r))]:[3,6];case 4:return t.sent(),[5,A(this.doAutoMoves_())];case 5:t.sent(),t.label=6;case 6:return[2];}})},r.prototype.canDrawFromStock_=function(){return this.stock.length>0},r.prototype.doDrawFromStock_=function(){var e,r;return G(this,function(t){switch(t.label){case 0:this.waste.maxFan=0,e=0,t.label=1;case 1:return e<this.options.stockDraws?(r=this.stock.peek())?(this.waste.push(r),this.waste.maxFan++,[4,z.Quick]):[3,4]:[3,5];case 2:return t.sent(),r.faceUp=!0,e<this.options.stockDraws-1?[4,z.Quick]:[3,4];case 3:t.sent(),t.label=4;case 4:return++e,[3,1];case 5:return[4,z.OneByOne];case 6:return t.sent(),[2];}})},r.prototype.isTableauxDrop_=function(e,r){if(e.pile===r)return!1;if(!this.isTableauxDropSource_(e))return!1;if(this.tableaux.indexOf(r)>=0){var t=r.peek();if(t){if(this.getCardValue_(t)===this.getCardValue_(e)+1&&t.colour!==e.colour)return!0}else if(e.rank===j.King)return!0}return!1},r.prototype.isTableauxDropSource_=function(e){var r;if(this.dragSingleSources_.indexOf(e.pile)>=0&&e.pile.peek()===e&&e.faceUp)return!0;if(this.tableaux.indexOf(e.pile)>=0&&(null===(r=e.pile.peek())||void 0===r?void 0:r.faceUp))for(var t=e.pile.length-1;t-->0;){var n=e.pile.at(t),a=e.pile.at(t+1);if(!((null==n?void 0:n.faceUp)&&(null==a?void 0:a.faceUp)&&n.colour!==a.colour&&this.getCardValue_(a)===this.getCardValue_(n)-1))return!1;if(n===e)return!0}return!1},r.prototype.doTableauxDrop_=function(e,r){var t,n,a,o,s,i,u;return G(this,function(c){switch(c.label){case 0:t=e.pile,n=e.pile.slice(e.pileIndex);try{for(a=A(n),o=a.next();!o.done;o=a.next())s=o.value,r.push(s)}catch(l){i={error:l}}finally{try{o&&!o.done&&(u=a.return)&&u.call(a)}finally{if(i)throw i.error}}return t===this.waste&&this.waste.maxFan--,[4,z.OneByOne];case 1:return c.sent(),[2];}})},r.prototype.isFoundationDrop_=function(e,r){if(e.pile===r)return!1;if(!this.isFoundationDropSource_(e))return!1;if(this.foundations.indexOf(r)>=0){var t=r.peek();if(t){if(this.getCardValue_(t)+1===this.getCardValue_(e)&&t.suit===e.suit)return!0}else if(e.rank===j.Ace)return!0}return!1},r.prototype.isFoundationDropSource_=function(e){return this.dragSingleSources_.indexOf(e.pile)>=0&&e.pile.peek()===e&&e.faceUp},r.prototype.doFoundationDrop_=function(e,r){var t;return G(this,function(n){switch(n.label){case 0:return t=e.pile,r.push(e),t===this.waste&&this.waste.maxFan--,[4,z.OneByOne];case 1:return n.sent(),[2];}})},r.prototype.getCardValue_=function(e){switch(e.rank){case j.Ace:return 1;case j.Two:return 2;case j.Three:return 3;case j.Four:return 4;case j.Five:return 5;case j.Six:return 6;case j.Seven:return 7;case j.Eight:return 8;case j.Nine:return 9;case j.Ten:return 10;case j.Jack:return 11;case j.Queen:return 12;case j.King:return 13;default:q.error();}},r.prototype.doAutoMoves_=function(){var e,r,t,n,a,o,s,i,u,c,l,$,p,h,w,_,f,d,v,T,L,y,k,b;return G(this,function(x){switch(x.label){case 0:if(!this.options.autoReveal)return[3,8];x.label=1;case 1:x.trys.push([1,6,7,8]),f=void 0,e=A(this.tableaux),r=e.next(),x.label=2;case 2:return r.done?[3,5]:(t=r.value,!(l=t.peek())||l.faceUp?[3,4]:(l.faceUp=!0,[4,z.OneByOne]));case 3:return x.sent(),[3,0];case 4:return r=e.next(),[3,2];case 5:return[3,8];case 6:return n=x.sent(),f={error:n},[3,8];case 7:try{r&&!r.done&&(d=e.return)&&d.call(e)}finally{if(f)throw f.error}return[7];case 8:if(!(this.options.autoMoveToFoundation>0))return[3,22];a=999;try{for(v=void 0,o=A(this.foundations),s=o.next();!s.done;s=o.next())c=s.value,l=c.peek(),a=l?Math.min(a,this.getCardValue_(l)):Math.min(a,0)}catch(m){v={error:m}}finally{try{s&&!s.done&&(T=o.return)&&T.call(o)}finally{if(v)throw v.error}}x.label=9;case 9:x.trys.push([9,20,21,22]),L=void 0,i=A(this.autoMoveSources_),u=i.next(),x.label=10;case 10:if(u.done)return[3,19];if(c=u.value,!((l=c.peek())&&this.getCardValue_(l)<=a+this.options.autoMoveToFoundation))return[3,18];x.label=11;case 11:x.trys.push([11,16,17,18]),k=void 0,$=A(this.foundations),p=$.next(),x.label=12;case 12:return p.done?[3,15]:(h=p.value,this.isFoundationDrop_(l,h)?[5,A(this.doFoundationDrop_(l,h))]:[3,14]);case 13:return x.sent(),[3,0];case 14:return p=$.next(),[3,12];case 15:return[3,18];case 16:return w=x.sent(),k={error:w},[3,18];case 17:try{p&&!p.done&&(b=$.return)&&b.call($)}finally{if(k)throw k.error}return[7];case 18:return u=i.next(),[3,10];case 19:return[3,22];case 20:return _=x.sent(),L={error:_},[3,22];case 21:try{u&&!u.done&&(y=i.return)&&y.call(i)}finally{if(L)throw L.error}return[7];case 22:return this.options.autoPlayStock&&0===this.waste.length&&this.canDrawFromStock_()?[5,A(this.doDrawFromStock_())]:[3,24];case 23:return x.sent(),[3,0];case 24:return[3,25];case 25:return[2];}})},r}(ta);Q.Game=Ka;var ua={};var nb=function(){function t(){}return t.clamp=function(t,$,r){return t<=$?$:t>=r?r:t},t}();var La=function(){function t(t){this.params_=t}return t.prototype.getNumber_=function(t,r){var e=this.params_.get(t);if("string"!=typeof e||""===e)return r;var a=Number(e);return Number.isNaN(a)?r:a},t.prototype.getBool_=function(t,r){var e=this.params_.get(t);return"string"!=typeof e?r:""===e||!!this.params_.get(t)},t}();var ob=ua&&ua.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function r(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ma=function(t){function o(o){var e=t.call(this,o)||this;return e.stockDraws=1,e.restocksAllowed=1/0,e.autoReveal=!0,e.autoPlayStock=!0,e.autoMoveToFoundation=2,e.stockDraws=nb.clamp(e.getNumber_("stockDraws",1),1,5),e.restocksAllowed=e.getNumber_("restocksAllowed",1/0),e.autoReveal=e.getBool_("autoReveal",!0),e.autoPlayStock=e.getBool_("autoPlayStock",!0),e.autoMoveToFoundation=Math.max(0,e.getNumber_("autoMoveToFoundation",2)),e}return ob(o,t),Object.defineProperty(o.prototype,"saveKey",{get:function(){return{stockDraws:this.stockDraws,restocksAllowed:this.restocksAllowed}},enumerable:!0,configurable:!0}),o}(La);ua.GameOptions=Ma;var fa={};var S={};var va={};var B=function(){function t(t,i,e,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),void 0===s&&(s=0),this.sizeX=t,this.sizeY=i,this.x=e,this.y=s}return Object.defineProperty(t.prototype,"xMin",{get:function(){return this.x-.5*this.sizeX},set:function(t){var i=this.xMax;this.sizeX=i-t,this.x=.5*t+.5*i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xMax",{get:function(){return this.x+.5*this.sizeX},set:function(t){var i=this.xMin;this.sizeX=t-i,this.x=.5*i+.5*t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yMin",{get:function(){return this.y-.5*this.sizeY},set:function(t){var i=this.yMax;this.sizeX=i-t,this.y=.5*t+.5*i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yMax",{get:function(){return this.y+.5*this.sizeY},set:function(t){var i=this.yMin;this.sizeX=t-i,this.y=.5*i+.5*t},enumerable:!0,configurable:!0}),t.prototype.set=function(t){return!this.equals(t)&&(this.x=t.x,this.y=t.y,this.sizeX=t.sizeX,this.sizeY=t.sizeY,!0)},t.prototype.setOnElement=function(t){t.style.left="calc(50% + "+(this.x-.5*this.sizeX)+"em)",t.style.right="calc(50% + "+(-this.x-.5*this.sizeX)+"em)",t.style.top="calc(50% + "+(this.y-.5*this.sizeY)+"em)",t.style.bottom="calc(50% + "+(-this.y-.5*this.sizeY)+"em)"},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.sizeX===t.sizeX&&this.sizeY===t.sizeY},t.prototype.overlaps=function(t){var i=Math.min(this.xMax,t.xMax)-Math.max(this.xMin,t.xMin);if(i<=0)return 0;var e=Math.min(this.yMax,t.yMax)-Math.max(this.yMin,t.yMin);return e<=0?0:i*e},t}();var wa=va&&va.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Na=function(){function t(t,e,r,i){var n=this;this.click=function(){},this.dblClick=function(){},this.dragStart=function(){return{canDrag:!1,extraCardViews:[]}},this.dragMoved=function(t){},this.dragEnd=function(t,e){},this.rect_=new B,this.zIndex_=0,this.faceUp_=!1,this.dropPreview_=!1,this.touchTracking_=!1,this.touchId_=0,this.touchInDeadZone_=!1,this.touchStartX_=0,this.touchStartY_=0,this.lastTouchEndTimeStamp_=0,this.dragging_=!1,this.dragExtraCardViews_=[],this.dragRect_=new B,this.onMouseDown_=function(t){0===t.button&&(t.preventDefault(),n.context.addTouchResponder(n),n.onTouchDown(-1,t.pageX,t.pageY,t.timeStamp))},this.touchStart_=function(t){for(var e=0;e<t.changedTouches.length;++e){var r=t.changedTouches.item(e);r&&(t.preventDefault(),n.context.addTouchResponder(n),n.onTouchDown(r.identifier,r.pageX,r.pageY,t.timeStamp))}},this.context=t.context,this.element=na.instantiateTemplate(t.element,"cardViewTemplate"),this.element.classList.add("s"+e+"c"+r+"r"+i),this.element.addEventListener("mousedown",this.onMouseDown_),this.element.addEventListener("touchstart",this.touchStart_)}return Object.defineProperty(t.prototype,"rect",{get:function(){var t=new B;return t.set(this.rect_),t},set:function(t){this.rect_.set(t)&&t.setOnElement(this.element)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this.zIndex_},set:function(t){this.zIndex_!==t&&(this.zIndex_=t,this.element.style.zIndex=""+t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"faceUp",{get:function(){return this.faceUp_},set:function(t){this.faceUp_!==t&&(this.faceUp_=t,t?this.element.classList.add("faceUp"):this.element.classList.remove("faceUp"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropPreview",{get:function(){return this.dropPreview_},set:function(t){this.dropPreview_!==t&&(this.dropPreview_=t,t?this.element.classList.add("dropPreview"):this.element.classList.remove("dropPreview"))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.element.remove()},t.prototype.onTouchDown=function(t,e,r,i){this.touchTracking_||(this.touchId_=t,this.touchTracking_=!0,this.touchInDeadZone_=!0,this.touchStartX_=e,this.touchStartY_=r,this.dragging_=!1)},t.prototype.onTouchMoved=function(t,e,r,i){var n,o;if(this.touchTracking_&&this.touchId_===t){var a=e-this.touchStartX_,s=r-this.touchStartY_;if(this.touchInDeadZone_){var h=a*a+s*s;if(h>N.TOUCH_DEADZONE_SQ){var c=Math.sqrt(h);a/=c,s/=c,this.touchStartX_+=N.TOUCH_DEADZONE*a,this.touchStartY_+=N.TOUCH_DEADZONE*s,this.touchInDeadZone_=!1,this.startDragging_()}}if(this.dragging_){this.touchStartX_=e,this.touchStartY_=r;var d=this.context.pxPerRem;this.dragRect_.x+=d*a,this.dragRect_.y+=d*s,this.dragRect_.setOnElement(this.element);try{for(var u=wa(this.dragExtraCardViews_),l=u.next();!l.done;l=u.next()){var g=l.value;g.dragRect_.x+=d*a,g.dragRect_.y+=d*s,g.dragRect_.setOnElement(g.element)}}catch(_){n={error:_}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(n)throw n.error}}this.dragMoved(this.dragRect_)}}},t.prototype.onTouchUp=function(t,e,r){this.touchTracking_&&this.touchId_===t&&(this.touchTracking_=!1,this.context.removeTouchResponder(this),this.touchInDeadZone_?(r<this.lastTouchEndTimeStamp_+1e3?this.dblClick():(this.lastTouchEndTimeStamp_=r,this.click()),this.stopDragging_(!0)):this.stopDragging_(!1))},t.prototype.startDragging_=function(){var t,e,r=this.dragStart(),i=r.canDrag,n=r.extraCardViews;if(i){this.dragging_=!0,this.dragExtraCardViews_=n,this.dragRect_.set(this.rect_),this.element.classList.add("dragging");try{for(var o=wa(this.dragExtraCardViews_),a=o.next();!a.done;a=o.next()){var s=a.value;s.dragRect_.set(s.rect_),s.element.classList.add("dragging")}}catch(h){t={error:h}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}}},t.prototype.stopDragging_=function(t){var e,r;if(this.dragging_){this.dragging_=!1,this.element.classList.remove("dragging"),this.rect_.setOnElement(this.element);try{for(var i=wa(this.dragExtraCardViews_),n=i.next();!n.done;n=i.next()){var o=n.value;o.element.classList.remove("dragging"),o.rect_.setOnElement(o.element)}}catch(a){e={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}this.dragEnd(this.dragRect_,t)}},t}();va.CardView=Na;var pb=function(){function t(t){var e=this;this.click=function(){},this.dblClick=function(){},this.fanXDown=0,this.fanXUp=0,this.fanYDown=0,this.fanYUp=0,this.cardCount=0,this.rect_=new B,this.hitbox_=new B,this.zIndex_=0,this.showFrame_=!1,this.dropPreview_=!1,this.touchTracking_=!1,this.touchId_=0,this.touchInDeadZone_=!1,this.touchStartX_=0,this.touchStartY_=0,this.lastTouchEndTimeStamp_=0,this.onMouseDown_=function(t){0===t.button&&(t.preventDefault(),e.context.addTouchResponder(e),e.onTouchDown(-1,t.pageX,t.pageY,t.timeStamp))},this.touchStart_=function(t){for(var i=0;i<t.changedTouches.length;++i){var o=t.changedTouches.item(i);o&&(t.preventDefault(),e.context.addTouchResponder(e),e.onTouchDown(o.identifier,o.pageX,o.pageY,t.timeStamp))}},this.context=t.context,this.element=na.instantiateTemplate(t.element,"pileViewTemplate"),this.element.addEventListener("mousedown",this.onMouseDown_),this.element.addEventListener("touchstart",this.touchStart_)}return Object.defineProperty(t.prototype,"rect",{get:function(){var t=new B;return t.set(this.rect_),t},set:function(t){this.rect_.set(t)&&t.setOnElement(this.element)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hitbox",{get:function(){var t=new B;return t.set(this.hitbox_),t},set:function(t){this.hitbox_.set(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this.zIndex_},set:function(t){this.zIndex_!==t&&(this.zIndex_=t,this.element.style.zIndex=""+t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showFrame",{get:function(){return this.showFrame_},set:function(t){this.showFrame_!==t&&(this.showFrame_=t,t?this.element.classList.add("showFrame"):this.element.classList.remove("showFrame"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropPreview",{get:function(){return this.dropPreview_},set:function(t){this.dropPreview_!==t&&(this.dropPreview_=t,t?this.element.classList.add("dropPreview"):this.element.classList.remove("dropPreview"))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.element.remove()},t.prototype.onTouchDown=function(t,e,i,o){this.touchTracking_||(this.touchId_=t,this.touchTracking_=!0,this.touchInDeadZone_=!0,this.touchStartX_=e,this.touchStartY_=i)},t.prototype.onTouchMoved=function(t,e,i,o){if(this.touchTracking_&&this.touchId_===t){var n=e-this.touchStartX_,r=i-this.touchStartY_;if(this.touchInDeadZone_){var h=n*n+r*r;if(h>N.TOUCH_DEADZONE_SQ){var s=Math.sqrt(h);n/=s,r/=s,this.touchStartX_+=N.TOUCH_DEADZONE*n,this.touchStartY_+=N.TOUCH_DEADZONE*r,this.touchInDeadZone_=!1}}}},t.prototype.onTouchUp=function(t,e,i){this.touchTracking_&&this.touchId_===t&&(this.touchTracking_=!1,this.context.removeTouchResponder(this),this.touchInDeadZone_&&(i<this.lastTouchEndTimeStamp_+1e3?(this.dblClick(),this.lastTouchEndTimeStamp_=i):this.click()))},t}();var K=S&&S.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(i,a){function o(e){try{u(n.next(e))}catch(r){a(r)}}function s(e){try{u(n.throw(e))}catch(r){a(r)}}function u(e){var r;e.done?i(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(o,s)}u((n=n.apply(e,r||[])).next())})},M=S&&S.__generator||function(e,r){var t,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue;}a=r.call(e,o)}catch(s){a=[6,s],n=0}finally{t=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},ga=S&&S.__values||function(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},xa=function(){function e(e,r){var t,n,i,a=this;this.pileViews_=[],this.pileToPileView_=new Map,this.pileViewtoPile_=new Map,this.cardViews_=[],this.cardToCardView_=new Map,this.cardViewtoCard_=new Map,this.dropPreview_=void 0,this.nextZIndex_=1e3,this.nextZIndexInc_=1,this.onWindowResize_=function(e){a.onResize_()},this.onWindowKeyDown_=function(e){e&&("y"===e.key&&e.ctrlKey?(a.redo_(),e.stopPropagation(),e.preventDefault()):"z"===e.key&&e.ctrlKey?(a.undo_(),e.stopPropagation(),e.preventDefault()):"n"===e.key&&(a.restart_(),e.stopPropagation(),e.preventDefault()))},this.operations_=[],this.game_=e,this.rootView_=r,null===(t=document.getElementById("newGameButton"))||void 0===t||t.addEventListener("click",function(e){e.preventDefault(),a.restart_()}),null===(n=document.getElementById("undoButton"))||void 0===n||n.addEventListener("click",function(e){e.preventDefault(),a.undo_()}),null===(i=document.getElementById("redoButton"))||void 0===i||i.addEventListener("click",function(e){e.preventDefault(),a.redo_()}),window.addEventListener("resize",this.onWindowResize_),window.addEventListener("keydown",this.onWindowKeyDown_)}return e.prototype.dispose=function(){this.rootView_.dispose()},e.prototype.start=function(){var e=window.localStorage.getItem(this.saveDataKey_);e&&this.game_.deserialize(e)||this.restart_()},e.prototype.relayoutAll_=function(){var e,r,t,n;try{for(var i=ga(this.game_.piles),a=i.next();!a.done;a=i.next()){var o=a.value,s=this.getPileView_(o);this.relayoutPile_(s,o)}}catch(l){e={error:l}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}try{for(var u=ga(this.game_.cards),c=u.next();!c.done;c=u.next()){var d=c.value;this.getCardView_(d).faceUp=d.faceUp}}catch(_){t={error:_}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}},e.prototype.createPileView_=function(e){var r=this,t=new pb(this.rootView_);return this.pileViews_.push(t),this.pileToPileView_.set(e,t),this.pileViewtoPile_.set(t,e),e.cardsChanged=function(){return r.onPileCardsChanged_(t,e)},e.maxFanChanged=function(){return r.onPileMaxFanChanged_(t,e)},t.click=function(){return r.pilePrimary_(e)},t.dblClick=function(){return r.pileSecondary_(e)},t},e.prototype.getPile_=function(e){var r=this.pileViewtoPile_.get(e);return r||q.error(),r},e.prototype.getPileView_=function(e){var r=this.pileToPileView_.get(e);return r||q.error(),r},e.prototype.onPileCardsChanged_=function(e,r){this.relayoutPile_(e,r)},e.prototype.onPileMaxFanChanged_=function(e,r){this.relayoutPile_(e,r)},e.prototype.relayoutPile_=function(e,r){var t;e.cardCount=r.length;for(var n=r.length;n-->0;){var i=r.at(n),a=this.getCardView_(i);t?a.zIndex=--t:t=a.zIndex}var o=r.length-r.maxFan,s=0,u=0,c=0,d=0;for(n=0;n<r.length;++n){i=r.at(n),a=this.getCardView_(i);var l=e.rect;s=c,u=d,l.x+=c,l.y+=d,n>=o&&(i.faceUp?(c+=e.fanXUp,d+=e.fanYUp):(c+=e.fanXDown,d+=e.fanYDown)),a.rect=l}var _=e.rect;_.x+=.5*s,_.y+=.5*u,_.sizeX+=s,_.sizeY+=u,e.hitbox=_},e.prototype.createCardView_=function(e){var r=this,t=new Na(this.rootView_,e.suit,e.colour,e.rank);return this.cardViews_.push(t),this.cardToCardView_.set(e,t),this.cardViewtoCard_.set(t,e),this.onCardPileChanged_(t,e),e.pileChanged=function(){return r.onCardPileChanged_(t,e)},this.onCardPileIndexChanged_(t,e),e.pileIndexChanged=function(){return r.onCardPileIndexChanged_(t,e)},this.onCardFaceUpChanged_(t,e),e.faceUpChanged=function(){return r.onCardFaceUpChanged_(t,e)},t.click=function(){return r.cardPrimary_(e)},t.dblClick=function(){return r.cardSecondary_(e)},t.dragStart=function(){return r.cardDragStart_(t,e)},t.dragMoved=function(n){return r.cardDragMoved_(t,e,n)},t.dragEnd=function(n,i){return r.cardDragEnd_(t,e,n,i)},t},e.prototype.getCard_=function(e){var r=this.cardViewtoCard_.get(e);return r||q.error(),r},e.prototype.getCardView_=function(e){var r=this.cardToCardView_.get(e);return r||q.error(),r},e.prototype.onCardPileChanged_=function(e,r){e.zIndex=this.getNextZIndex_()},e.prototype.onCardPileIndexChanged_=function(e,r){},e.prototype.onCardFaceUpChanged_=function(e,r){e.faceUp=r.faceUp},e.prototype.cardDragStart_=function(e,r){var t,n,i=this.game_.canDrag(r),a=i.canDrag,o=i.extraCards;a&&(e.zIndex=this.getNextZIndex_());var s=[];try{for(var u=ga(o),c=u.next();!c.done;c=u.next()){var d=c.value,l=this.getCardView_(d);s.push(l),a&&(l.zIndex=this.getNextZIndex_())}}catch(_){t={error:_}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return{canDrag:a,extraCardViews:s}},e.prototype.cardDragMoved_=function(e,r,t){var n=this.getBestDragPile_(r,t);if(n){var i=n.peek();if(i){var a=this.getCardView_(i);return void this.setDropPreview_(a)}var o=this.getPileView_(n);this.setDropPreview_(o)}else this.setDropPreview_(void 0)},e.prototype.cardDragEnd_=function(e,r,t,n){var i=this;if(!n){var a=this.getBestDragPile_(r,t);a&&this.addOperation_(function(){return i.game_.dropCard(r,a)})}this.setDropPreview_(void 0)},e.prototype.getBestDragPile_=function(e,r){var t,n,i,a=0;try{for(var o=ga(this.pileViews_),s=o.next();!s.done;s=o.next()){var u=s.value,c=this.getPile_(u),d=u.hitbox,l=r.overlaps(d);l<=0||(!i||a<l)&&this.game_.previewDrop(e,c)&&(i=c,a=l)}}catch(_){t={error:_}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},e.prototype.setDropPreview_=function(e){e!==this.dropPreview_&&(this.dropPreview_&&(this.dropPreview_.dropPreview=!1),this.dropPreview_=e,this.dropPreview_&&(this.dropPreview_.dropPreview=!0))},e.prototype.getNextZIndex_=function(){var e=this.nextZIndex_;return this.nextZIndex_+=this.nextZIndexInc_,e},e.prototype.undo_=function(){return K(this,void 0,void 0,function(){var e=this;return M(this,function(r){return this.addOperation_(function(){return e.game_.undo()}),[2]})})},e.prototype.redo_=function(){return K(this,void 0,void 0,function(){var e=this;return M(this,function(r){return this.addOperation_(function(){return e.game_.redo()}),[2]})})},e.prototype.restart_=function(){return K(this,void 0,void 0,function(){var e=this;return M(this,function(r){return this.addOperation_(function(){return e.game_.restart(Date.now())}),[2]})})},e.prototype.pilePrimary_=function(e){return K(this,void 0,void 0,function(){var r=this;return M(this,function(t){return this.addOperation_(function(){return r.game_.pilePrimary(e)}),[2]})})},e.prototype.pileSecondary_=function(e){return K(this,void 0,void 0,function(){var r=this;return M(this,function(t){return this.addOperation_(function(){return r.game_.pileSecondary(e)}),[2]})})},e.prototype.cardPrimary_=function(e){return K(this,void 0,void 0,function(){var r=this;return M(this,function(t){return this.addOperation_(function(){return r.game_.cardPrimary(e)}),[2]})})},e.prototype.cardSecondary_=function(e){return K(this,void 0,void 0,function(){var r=this;return M(this,function(t){return this.addOperation_(function(){return r.game_.cardSecondary(e)}),[2]})})},e.prototype.addOperation_=function(e){return K(this,void 0,void 0,function(){var r,t,n,i,a,o,s,u;return M(this,function(c){switch(c.label){case 0:if(r=0,0!==this.operations_.length)return[3,11];this.operations_.push(e),c.label=1;case 1:if(!(this.operations_.length>0))return[3,10];t=this.operations_[0],c.label=2;case 2:c.trys.push([2,7,8,9]),s=void 0,n=ga(t()),i=n.next(),c.label=3;case 3:return i.done?[3,6]:(a=i.value,[4,this.waitForDelay_(a,r++)]);case 4:c.sent(),c.label=5;case 5:return i=n.next(),[3,3];case 6:return[3,9];case 7:return o=c.sent(),s={error:o},[3,9];case 8:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 9:return this.operations_.shift(),[3,1];case 10:try{window.localStorage.setItem(this.saveDataKey_,this.game_.serialize())}catch(d){}return[3,12];case 11:this.operations_.push(e),c.label=12;case 12:return[2];}})})},e.prototype.waitForDelay_=function(e,r){return K(this,void 0,void 0,function(){var t;return M(this,function(n){switch(n.label){case 0:switch(t=Math.pow(.95,r),e){case z.None:return[3,1];case z.Quick:return[3,2];case z.OneByOne:return[3,4];case z.Settle:return[3,6];}return[3,8];case 1:return[2];case 2:return[4,new Promise(function(e){return setTimeout(e,20*t)})];case 3:return n.sent(),[2];case 4:return[4,new Promise(function(e){return setTimeout(e,200*t)})];case 5:return n.sent(),[2];case 6:return[4,new Promise(function(e){return setTimeout(e,400*t)})];case 7:return n.sent(),[2];case 8:return[2];}})})},e}();S.GamePresenterBase=xa;var qb=fa&&fa.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),rb=fa&&fa.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},U=1,Z=20,ha=Z/1.555555555555,Oa=function(e){function t(t,r){var a,i,n=e.call(this,t,r)||this;n.foundationPiles_=[],n.tableauPiles_=[],($=n.createPileView_(t.stock)).showFrame=!0,n.stockPile_=$,($=n.createPileView_(t.waste)).showFrame=!0,$.zIndex=50,$.fanXUp=3,n.wastePile_=$;for(var o=0;o<n.game_.foundations.length;++o){($=n.createPileView_(t.foundations[o])).showFrame=!0,$.zIndex=800,n.foundationPiles_.push($)}for(o=0;o<n.game_.tableaux.length;++o){var $;($=n.createPileView_(t.tableaux[o])).showFrame=!0,$.zIndex=800,n.tableauPiles_.push($)}try{for(var s=rb(t.cards),h=s.next();!h.done;h=s.next()){var l=h.value;n.createCardView_(l)}}catch(u){a={error:u}}finally{try{h&&!h.done&&(i=s.return)&&i.call(s)}finally{if(a)throw a.error}}return n.layoutPiles_(),n.relayoutAll_(),n}return qb(t,e),Object.defineProperty(t.prototype,"saveDataKey_",{get:function(){return JSON.stringify({gameName:"klondike",version:0,options:this.game_.options.saveKey})},enumerable:!0,configurable:!0}),t.prototype.onResize_=function(){this.layoutPiles_(),this.relayoutAll_()},t.prototype.layoutPiles_=function(){var e=this.game_.tableaux.length,t=1;window.matchMedia("screen and (max-aspect-ratio: 100/130)").matches&&(t=1.5);var r=function(t){return(t-.5*(e-1))*(ha+U)},a=this.game_.stock;(n=this.getPileView_(a)).rect=new B(ha,Z,r(0),-35*t+U);a=this.game_.waste;(n=this.getPileView_(this.game_.waste)).rect=new B(ha,Z,r(1),-35*t+U);for(var i=0;i<this.game_.foundations.length;++i){a=this.game_.foundations[i];(n=this.getPileView_(a)).rect=new B(ha,Z,r(e-this.game_.foundations.length+i),-35*t+U)}for(i=0;i<this.game_.tableaux.length;++i){var n;a=this.game_.tableaux[i];(n=this.getPileView_(a)).rect=new B(ha,Z,r(i),-35*t+U+U+Z+U),n.fanYDown=3.5,n.fanYUp=3.5*t}},t}(xa);fa.GamePresenter=Oa;var Pa=function(){function e(){}return e.prototype.createGame=function(e,r){var $=new Ma(r),t=new Ka($),m=new za(e);return new Oa(t,m)},e}();var V={};var sb=V&&V.__extends||function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),W=V&&V.__generator||function(e,r){var t,n,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue;}s=r.call(e,o)}catch(i){s=[6,i],n=0}finally{t=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},H=V&&V.__values||function(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},tb=7,Qa=function(e){function r(r){var t=e.call(this)||this;t.stock=new D(t),t.waste=new D(t),t.foundation=new D(t),t.pyramid=[],t.pyramidCoords_=new Map,t.restocks_=0,t.options=r,t.piles.push(t.stock),t.piles.push(t.waste),t.piles.push(t.foundation);for(var n=0;n<tb;++n){t.pyramid.push([]);for(var a=0;a<=n;++a){var s=new D(t);t.pyramid[n].push(s),t.pyramidCoords_.set(s,{x:a,y:n}),t.piles.push(s)}}return t.cards=oa.createStandard52Deck(t.stock),t}return sb(r,e),r.prototype.restart_=function(e){var r,t,n,a,s,o,i,u,c,$,l,p,v,h,f,x,_,d,y;return W(this,function(F){switch(F.label){case 0:this.restocks_=0;try{for(r=H(this.stock),t=r.next();!t.done;t=r.next())(l=t.value).faceUp=!1}catch(k){h={error:k}}finally{try{t&&!t.done&&(f=r.return)&&f.call(r)}finally{if(h)throw h.error}}for(n=this.piles.length;n-->0;)if(($=this.piles[n])!==this.stock)for(a=$.length;a-->0;)(l=$.at(a)).faceUp=!1,this.stock.push(l);return this.stock.sort(),this.stock.shuffle(e),[4,z.Settle];case 1:F.sent(),F.label=2;case 2:F.trys.push([2,13,14,15]),s=H(this.pyramid),o=s.next(),F.label=3;case 3:if(o.done)return[3,12];i=o.value,F.label=4;case 4:F.trys.push([4,9,10,11]),d=void 0,u=H(i),c=u.next(),F.label=5;case 5:return c.done?[3,8]:($=c.value,(l=this.stock.peek())?($.push(l),l.faceUp=!0,[4,z.Quick]):[3,7]);case 6:F.sent(),F.label=7;case 7:return c=u.next(),[3,5];case 8:return[3,11];case 9:return p=F.sent(),d={error:p},[3,11];case 10:try{c&&!c.done&&(y=u.return)&&y.call(u)}finally{if(d)throw d.error}return[7];case 11:return o=s.next(),[3,3];case 12:return[3,15];case 13:return v=F.sent(),x={error:v},[3,15];case 14:try{o&&!o.done&&(_=s.return)&&_.call(s)}finally{if(x)throw x.error}return[7];case 15:return[5,H(this.doAutoMoves_())];case 16:return F.sent(),[2];}})},r.prototype.cardPrimary_=function(e){return W(this,function(r){switch(r.label){case 0:return e.rank===j.King&&this.isFree_(e)?(this.foundation.push(e),[5,H(this.doAutoMoves_())]):[3,2];case 1:return r.sent(),[2];case 2:return this.stock.peek()!==e?[3,4]:(e.faceUp?this.waste.push(e):e.faceUp=!0,[5,H(this.doAutoMoves_())]);case 3:return r.sent(),[2];case 4:return[2];}})},r.prototype.cardSecondary_=function(e){return W(this,function(e){return[2]})},r.prototype.pilePrimary_=function(e){var r,t;return W(this,function(n){switch(n.label){case 0:if(!(e===this.stock&&0===this.stock.length&&this.waste.length>0&&this.restocks_<this.options.restocksAllowed))return[3,3];for(this.restocks_++,r=this.waste.length;r-->0;)(t=this.waste.at(r)).faceUp=!1;return[4,z.OneByOne];case 1:for(n.sent(),r=this.waste.length;r-->0;)t=this.waste.at(r),this.stock.push(t);return[5,H(this.doAutoMoves_())];case 2:return n.sent(),[2];case 3:return[2];}})},r.prototype.pileSecondary_=function(e){return W(this,function(e){return[2]})},r.prototype.canDrag_=function(e){return{canDrag:this.isFree_(e),extraCards:[]}},r.prototype.previewDrop_=function(e,r){return this.is13Move_(e,r)},r.prototype.dropCard_=function(e,r){return W(this,function(t){switch(t.label){case 0:return this.is13Move_(e,r)?(this.foundation.push(r.peek()),this.foundation.push(e),[5,H(this.doAutoMoves_())]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2];}})},r.prototype.isFree_=function(e){if(!e.faceUp)return!1;if(this.stock.peek()===e)return!0;if(this.waste.peek()===e)return!0;if(e.pile){var r=this.pyramidCoords_.get(e.pile);if(r){var t=this.pyramid[r.y+1];if(!t)return!0;var n=t[r.x],a=t[r.x+1];return 0===n.length&&0===a.length}}return!1},r.prototype.is13Move_=function(e,r){if(e.pile===r)return!1;if(!this.isFree_(e))return!1;var t=r.peek();return!!t&&!!this.isFree_(t)&&this.getCardValue_(e)+this.getCardValue_(t)===13},r.prototype.getCardValue_=function(e){switch(e.rank){case j.Ace:return 1;case j.Two:return 2;case j.Three:return 3;case j.Four:return 4;case j.Five:return 5;case j.Six:return 6;case j.Seven:return 7;case j.Eight:return 8;case j.Nine:return 9;case j.Ten:return 10;case j.Jack:return 11;case j.Queen:return 12;case j.King:return 13;default:return 0;}},r.prototype.doAutoMoves_=function(){var e,r,t,n,a,s,o,i,u,c,$,l,p;return W(this,function(v){switch(v.label){case 0:return this.options.autoPlayKings?(u=this.stock.peek())&&this.isFree_(u)&&13===this.getCardValue_(u)?[4,z.OneByOne]:[3,2]:[3,17];case 1:return v.sent(),this.foundation.push(u),[3,0];case 2:return(u=this.waste.peek())&&this.isFree_(u)&&13===this.getCardValue_(u)?[4,z.OneByOne]:[3,4];case 3:return v.sent(),this.foundation.push(u),[3,0];case 4:v.trys.push([4,15,16,17]),c=void 0,e=H(this.pyramid),r=e.next(),v.label=5;case 5:if(r.done)return[3,14];t=r.value,v.label=6;case 6:v.trys.push([6,11,12,13]),l=void 0,n=H(t),a=n.next(),v.label=7;case 7:return a.done?[3,10]:(s=a.value,(u=s.peek())&&this.isFree_(u)&&13===this.getCardValue_(u)?[4,z.OneByOne]:[3,9]);case 8:return v.sent(),this.foundation.push(u),[3,0];case 9:return a=n.next(),[3,7];case 10:return[3,13];case 11:return o=v.sent(),l={error:o},[3,13];case 12:try{a&&!a.done&&(p=n.return)&&p.call(n)}finally{if(l)throw l.error}return[7];case 13:return r=e.next(),[3,5];case 14:return[3,17];case 15:return i=v.sent(),c={error:i},[3,17];case 16:try{r&&!r.done&&($=e.return)&&$.call(e)}finally{if(c)throw c.error}return[7];case 17:return this.options.autoRevealStockTop&&(u=this.stock.peek())&&!1===u.faceUp?[4,z.OneByOne]:[3,19];case 18:return v.sent(),u.faceUp=!0,[3,0];case 19:return[3,20];case 20:return[2];}})},r}(ta);V.Game=Qa;var ya={};var ub=ya&&ya.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),Ra=function(t){function e(e){var o=t.call(this,e)||this;return o.restocksAllowed=2,o.autoRevealStockTop=!0,o.autoPlayKings=!0,o.restocksAllowed=o.getNumber_("restocksAllowed",1/0),o.autoRevealStockTop=o.getBool_("autoRevealStockTop",!0),o.autoPlayKings=o.getBool_("autoPlayKings",!0),o}return ub(e,t),Object.defineProperty(e.prototype,"saveKey",{get:function(){return{restocksAllowed:this.restocksAllowed}},enumerable:!0,configurable:!0}),e}(La);ya.GameOptions=Ra;var ia={};var vb=ia&&ia.__extends||function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function a(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}(),Sa=ia&&ia.__values||function(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],a=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},aa=20,ja=aa/1.555555555555,wb=1.5,xb=-7,Ta=function(e){function r(r,t){var a,i,n,o,$=e.call(this,r,t)||this;$.pyramidPiles_=[],(p=$.createPileView_(r.stock)).showFrame=!0,$.stockPile_=p,(p=$.createPileView_(r.waste)).showFrame=!0,p.zIndex=50,$.wastePile_=p,(p=$.createPileView_(r.foundation)).showFrame=!0,p.zIndex=800,$.foundationPile_=p;for(var f=0;f<r.pyramid.length;++f){var s=r.pyramid[f],l=[];try{for(var c=(a=void 0,Sa(s)),u=c.next();!u.done;u=c.next()){var p,b=u.value;(p=$.createPileView_(b)).zIndex=100*f,l.push(p)}}catch(O){a={error:O}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}$.pyramidPiles_.push(l)}try{for(var v=Sa(r.cards),_=v.next();!_.done;_=v.next()){var y=_.value;$.createCardView_(y)}}catch(J){n={error:J}}finally{try{_&&!_.done&&(o=v.return)&&o.call(v)}finally{if(n)throw n.error}}return $.layoutPiles_(),$.relayoutAll_(),$}return vb(r,e),Object.defineProperty(r.prototype,"saveDataKey_",{get:function(){return JSON.stringify({gameName:"pyramid",version:0,options:this.game_.options.saveKey})},enumerable:!0,configurable:!0}),r.prototype.onResize_=function(){this.layoutPiles_(),this.relayoutAll_()},r.prototype.layoutPiles_=function(){var e=this.game_.pyramid.length,r=function(e,r){return(e-.5*(r-1))*(ja+wb)},t=function(r){return(r-.5*(e-1))*(aa+xb)};this.stockPile_.rect=new B(ja,aa,r(0,e),t(0)),this.wastePile_.rect=new B(ja,aa,r(1,e),t(0)),this.foundationPile_.rect=new B(ja,aa,r(e-1,e),t(0));for(var a=0;a<e;++a)for(var i=this.game_.pyramid[a],n=0;n<i.length;++n){this.pyramidPiles_[a][n].rect=new B(ja,aa,r(n,i.length),t(a))}},r}(xa);ia.GamePresenter=Ta;var yb=function(){function e(){}return e.prototype.createGame=function(e,r){var $=new Ra(r),t=new Qa($),o=new za(e);return new Ta(t,o)},e}();window.addEventListener("load",function(){var e,r=new Map;r.set("",new Pa),r.set("klondike",new Pa),r.set("pyramid",new yb);var a,n=null!==(e=document.getElementById("tableHolder"))&&void 0!==e?e:document.body,t=function(){var e;a&&(a.dispose(),a=void 0);var t,o,i=window.location.hash,s=i.indexOf("?");s>=0?(t=new URLSearchParams(i.substr(s+1)),o=i.substr(1,s-1)):i.indexOf("&")>=0||i.indexOf("?")>=0||i.indexOf("=")>=0?o=null!==(e=(t=new URLSearchParams(i.substr(1))).get("game"))&&void 0!==e?e:"klondike":(t=new URLSearchParams(""),o=i.substr(1));var d=r.get(o.toLowerCase());d||q.error("Unknown game "+o+"."),(a=d.createGame(n,t)).start()};window.addEventListener("hashchange",t),t()});return{"QCba":{}};});